# ガントチャート機能 仕様書

> **ステータス**: ドラフト v2（レビュー待ち）
> **作成日**: 2026-01-27
> **最終更新**: 2026-01-27

---

## 1. 概要

### 1.1 目的
工数管理システムに**スケジュール管理機能**を追加する。見積データを基に、着手日を指定するだけで予定期間を自動計算し、実績と重ねて進捗を可視化する。

### 1.2 コアコンセプト
```
┌─────────────────────────────────────────────────────────────┐
│  【計画】着手日 + 見積工数 → 自動で予定期間を算出           │
│  【実績】日々の作業実績を予定バーに重ねて表示               │
│  【進捗】工程ごとの完了状況・残作業を一目で把握             │
│  【操作】ドラッグ&ドロップで予定を視覚的に調整              │
└─────────────────────────────────────────────────────────────┘
```

### 1.3 主要機能
1. **着手日指定 → 予定自動生成**: 見積工数から終了日を自動計算
2. **計画 vs 実績の可視化**: 2層バーで計画と実績を比較表示
3. **進捗トラッキング**: 工程ごとの完了率・残作業表示
4. **視覚的操作**: ドラッグで着手日変更、クリックで詳細編集

---

## 2. 機能要件

### 2.1 ガントチャート表示

#### 2.1.1 2層バー表示
```
担当者/タスク   1月
               6  7  8  9 10 11 12 13 14 15 16 17 18 19 20
               月 火 水 木 金 土 日 月 火 水 木 金 土 日 月
─────────────────────────────────────────────────────────────
田中                      
├ v1.0/機能A/設計  ██████████████░░░░░░  ← 計画（薄い色）
│                  ████████████         ← 実績（濃い色）60%完了
│                  
├ v1.0/機能A/実装         ░░░░░░░░░░░░░░░░░░░░░░  ← 未着手
│                  
佐藤
├ v1.0/機能B/設計  ████████████████████  ← 100%完了
│                  ████████████████████
...
```

#### 2.1.2 バーの構成
| 要素 | 説明 |
|------|------|
| 計画バー（下層） | 薄い色。着手日〜見積工数で計算した終了日 |
| 実績バー（上層） | 濃い色。実際に作業した日を塗りつぶし |
| 進捗率 | 実績時間 ÷ 見積時間 をバー上にパーセント表示 |
| 遅延表示 | 計画終了日を過ぎても未完了の場合、赤でハイライト |

#### 2.1.3 行の構成オプション
- **担当者 → タスク → 工程**: 階層表示（折りたたみ可能）
- **タスク → 担当者 → 工程**: プロジェクト視点の表示

### 2.2 予定データ構造

#### 2.2.1 `schedules` データ構造
```javascript
{
  id: "sch_001",
  // 紐付け情報
  member: "田中",
  version: "1.0",
  task: "機能A",
  process: "設計",           // 工程（設計/実装/テスト/その他）
  
  // 計画情報
  startDate: "2026-01-10",   // 着手日（ユーザーが指定）
  estimatedHours: 24,        // 見積工数（見積データから取得）
  endDate: "2026-01-14",     // 終了予定日（自動計算）
  
  // 状態
  status: "in_progress",     // pending / in_progress / completed
  
  // メタデータ
  color: "#4A90D9",
  note: "",
  createdAt: "2026-01-27T10:00:00Z",
  updatedAt: "2026-01-27T10:00:00Z"
}
```

#### 2.2.2 実績データとの連携
既存の `actuals` データを使用:
```javascript
// 既存の実績データ
{
  id: "act_001",
  member: "田中",
  version: "1.0",
  task: "機能A",
  process: "設計",
  date: "2026-01-10",
  hours: 8,
  ...
}
```
→ 予定と同じ (member, version, task, process) でマッチングし、実績バーを表示

### 2.3 予定の作成・操作

#### 2.3.1 予定作成フロー
```
1. 見積データから対象を選択（版数/タスク/担当者/工程）
2. 着手日を指定（カレンダーまたはドラッグ）
3. → 見積工数から終了日を自動計算
4. → 予定バーがチャートに表示される
```

#### 2.3.2 予定の調整方法
| 操作 | 方法 |
|------|------|
| 着手日変更 | バーをドラッグして左右に移動 |
| 詳細編集 | バーをクリック → モーダルで編集 |
| 削除 | モーダル内の削除ボタン or 右クリックメニュー |

#### 2.3.3 一括作成
- 版数単位で一括予定作成
- 各タスク・工程に着手日を順次自動割り当て（依存関係考慮）

### 2.4 進捗の可視化

#### 2.4.1 進捗表示
```
┌───────────────────────────────────────────────────────┐
│ v1.0 / 機能A                                          │
├───────────────────────────────────────────────────────┤
│ [設計] ████████████████████ 100%  ✓完了              │
│ [実装] ████████░░░░░░░░░░░░  40%  🔄進行中 残:12h    │
│ [テスト] ░░░░░░░░░░░░░░░░░░░   0%  ⏳未着手 予定:8h   │
└───────────────────────────────────────────────────────┘
```

#### 2.4.2 サマリーパネル
チャート上部または右側に表示:
- **完了タスク数**: 5/12 タスク完了
- **遅延タスク**: 2件（赤でハイライト）
- **今週の予定**: 田中: 40h, 佐藤: 32h
- **残作業合計**: 120h

### 2.5 終了日の自動計算ロジック

#### 2.5.1 基本ロジック
```
終了日 = 着手日 + 見積工数（営業日ベース）

例: 着手日=1/10(金), 見積工数=24h(3人日)
    → 1/10(金), 1/13(月), 1/14(火) = 終了日: 1/14
    ※ 土日(1/11, 1/12)はスキップ
```

#### 2.5.2 スキップ対象
- 土曜・日曜
- 祝日（holiday_jp）
- 会社休日（companyHolidays）
- 担当者の個人休暇（vacations）

#### 2.5.3 1日の作業時間
- デフォルト: 8時間/日
- 設定で変更可能（将来対応）

---

## 3. UI設計

### 3.1 全体レイアウト
```
┌─────────────────────────────────────────────────────────────────────┐
│ [< 前月] [2026年1月] [次月 >]  [今日] [週|月] [+ 予定作成] [⚙設定] │
├─────────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────┐ ┌─────────────────────────────────────┐│
│ │ 📊 サマリー             │ │     1月                             ││
│ │ 完了: 5/12 タスク       │ │   6  7  8  9 10 11 12 13 14 15 ... ││
│ │ 遅延: 2件               │ ├─────────────────────────────────────┤│
│ │ 残作業: 120h            │ │ ▼ 田中                              ││
│ │                         │ │   ├ 機能A/設計 ████████░░░          ││
│ │ ⏰ 今週の予定           │ │   ├ 機能A/実装    ░░░░░░░░░░        ││
│ │ 田中: 40h               │ │ ▼ 佐藤                              ││
│ │ 佐藤: 32h               │ │   ├ 機能B/設計 ████████████          ││
│ └─────────────────────────┘ │   ...                               ││
│                             └─────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 予定作成モーダル
```
┌─────────────────────────────────────┐
│ 予定の作成                    [×]   │
├─────────────────────────────────────┤
│ 📋 見積から選択                     │
│ 版数:   [1.0 ▼]                     │
│ タスク: [機能A ▼]                   │
│ 担当者: [田中 ▼]                    │
│ 工程:   [設計 ▼]                    │
│                                     │
│ 見積工数: 24時間（3人日）           │
│                                     │
│ 📅 着手日                           │
│ [2026-01-15] [カレンダー📅]         │
│                                     │
│ → 終了予定日: 2026-01-17（3営業日） │
│                                     │
│              [キャンセル] [作成]    │
└─────────────────────────────────────┘
```

### 3.3 ドラッグ操作
```
ドラッグ前:     |████████|
                ↓ 左にドラッグ
ドラッグ中:   |████████|  ← 半透明で移動先プレビュー
                ↓ ドロップ
ドラッグ後:   |████████|  ← 着手日が変更される
```

### 3.4 進捗詳細モーダル（バークリック時）
```
┌─────────────────────────────────────┐
│ v1.0 / 機能A / 設計 / 田中    [×]   │
├─────────────────────────────────────┤
│ 📊 進捗状況                         │
│ ████████████░░░░░░░░ 60%            │
│                                     │
│ 計画: 1/10 〜 1/14 (24h)            │
│ 実績: 14.5h 作業済み                │
│ 残り: 9.5h                          │
│                                     │
│ 📅 実績内訳                         │
│ ┌────────┬───────┬────────┐         │
│ │ 日付   │ 時間  │ メモ   │         │
│ ├────────┼───────┼────────┤         │
│ │ 1/10   │ 8.0h  │        │         │
│ │ 1/13   │ 6.5h  │ レビュー│        │
│ └────────┴───────┴────────┘         │
│                                     │
│ 着手日: [2026-01-10] [変更]         │
│                                     │
│ [削除]              [閉じる]        │
└─────────────────────────────────────┘
```

---

## 4. 実装フェーズ（更新）

### Phase 1: 基盤 + 表示
1. データ構造定義
2. スケジュールタブUI
3. 月表示ガントチャート描画
4. 計画バー表示（実績なし）

### Phase 2: 予定作成・操作
1. 予定作成モーダル（着手日指定→自動計算）
2. 予定編集・削除
3. ドラッグ&ドロップで着手日変更

### Phase 3: 実績連携・進捗表示
1. 実績データとの紐付け
2. 2層バー表示（計画+実績）
3. 進捗率・遅延表示
4. サマリーパネル

### Phase 4: 機能拡充
1. 週表示モード
2. 一括予定作成
3. フィルタリング
4. Excel出力

---

## 5. 決定事項

| 項目 | 決定内容 |
|------|----------|
| 予定作成 | 着手日のみ指定、終了日は見積工数から自動計算 |
| 表示 | 計画バー（下層）+ 実績バー（上層）の2層表示 |
| 操作 | ドラッグ&ドロップで着手日変更、クリックで詳細編集 |
| 進捗 | 工程ごとの完了率・残作業時間を表示 |
| 1日の作業時間 | 8時間（デフォルト） |
| 遅延表示 | 計画終了日を過ぎて未完了の場合は赤でハイライト |
| バーの色 | タスクごとに自動割当 |
| 削除時 | 確認ダイアログ表示 |

---

## 6. 全決定事項まとめ

| カテゴリ | 項目 | 決定内容 |
|----------|------|----------|
| **表示** | 行の構成 | 切り替え可能（担当者→タスク / タスク→担当者） |
| | バー表示 | 計画バー（下層）+ 実績バー（上層）の2層表示 |
| | サマリー | チャート上部に進捗サマリーパネル表示 |
| | バーの色 | タスクごとに自動割当 |
| | 遅延表示 | 計画終了日を過ぎて未完了は赤でハイライト |
| **予定作成** | 入力項目 | 着手日のみ指定、終了日は見積工数から自動計算 |
| | 依存関係 | 工程の順序を考慮（設計→実装→テスト） |
| | 休日考慮 | 土日・祝日・会社休日・個人休暇を自動スキップ |
| | 1日の作業時間 | 8時間（デフォルト） |
| **操作** | 着手日変更 | ドラッグ&ドロップで視覚的に調整 |
| | 詳細編集 | バークリックでモーダル表示 |
| | 削除時 | 確認ダイアログ表示 |
| **進捗** | 進捗率 | 実績時間 ÷ 見積時間 をパーセント表示 |
| | 残作業 | 見積時間 - 実績時間 を表示 |

---

## 変更履歴

| 日付 | 変更内容 | 担当 |
|------|----------|------|
| 2026-01-27 | 初版作成 | Claude |
| 2026-01-27 | v2: 着手日指定→自動計算、実績重ね表示、ドラッグ操作追加 | Claude |