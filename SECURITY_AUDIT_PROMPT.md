# Webアプリケーション セキュリティ監査と修正

このリポジトリのWebアプリケーションコード全体を対象に、セキュリティ監査を実施してください。
脆弱性の検出だけでなく、具体的なコード修正の提案と実施までを行います。

## 監査プロセス

以下のフェーズに沿って作業し、タスクリストで進捗を管理してください。

### フェーズ1: 技術スタックと構造の把握
- ディレクトリ構造、使用言語、フレームワーク、外部依存を調査する
- データの流れ（入力→処理→保存→表示）を把握する
- この結果をレポート冒頭の「監査対象の概要」セクションに記載する

### フェーズ2: 脆弱性の検出
以下のカテゴリごとに、コードを検索・読解して脆弱性を特定する:

**入力処理・DOM操作**
- XSS（DOMベース／リフレクト型／ストアド型）: `innerHTML`, `outerHTML`, `document.write`, `insertAdjacentHTML` 等の使用箇所
- DOM操作時のサニタイズ不備
- URL／location／クエリ文字列からDOMへの挿入フロー

**データ保存・通信**
- localStorage / IndexedDB のデータ漏洩・改ざんリスク
- JSON／外部データの信頼境界と処理
- CSRF対策の有無

**セキュリティ設定**
- CSP（Content Security Policy）の有無と強度
- 外部スクリプト・CDN依存によるサプライチェーンリスク（SRIハッシュの有無）

**認証・認可・セッション**（該当する場合のみ）
- 認証・認可ロジックの誤り
- セッション管理・トークン保存の安全性
- API設計上の情報露出

**危険なAPI使用**
- `eval`, `new Function`, `setTimeout`/`setInterval` への文字列渡し等

### フェーズ3: 監査レポート作成
検出結果を `SECURITY_AUDIT_REPORT.md` にまとめる（後述のフォーマットに従う）。

### フェーズ4: 修正の実施
レポート完成後、検出した脆弱性について以下の手順で修正を進める:

1. レポート内の全脆弱性を深刻度順（Critical → High → Medium → Low）にリスト化する
2. 修正対象ごとに、修正内容の概要をユーザーに提示して承認を得る
3. 承認された修正をコードに適用する
4. 修正完了後、レポートの該当箇所に修正ステータスを追記する

**修正判断の基準:**
- **Critical / High**: 必ず修正を提案する
- **Medium**: 修正を提案し、対応要否をユーザーに確認する
- **Low**: レポートに記載のみとし、修正はユーザーが希望した場合のみ行う

## 各脆弱性の報告フォーマット

検出した各脆弱性について、以下の項目を記載してください:

1. **概要**: 脆弱性の種類と影響の要約（1〜2文）
2. **該当箇所**: ファイルパスと行番号（例: `js/render.js:42`）
3. **確信度**: High / Medium / Low（誤検出の可能性を考慮）
4. **深刻度**: 以下の基準で評価
   - **Critical**: 認証不要で任意コード実行・データ窃取が可能
   - **High**: ユーザー操作を伴うが攻撃成立時の影響が大きい
   - **Medium**: 限定的な条件下で悪用可能、または影響が限定的
   - **Low**: 理論上のリスクはあるが実際の攻撃成立が困難
5. **攻撃シナリオ**: 攻撃者がこの脆弱性をどう悪用するかの具体的な手順
6. **修正コード**: 以下の形式で、修正前と修正後のコードを提示する
   ```
   <!-- 修正前: ファイルパス:行番号 -->
   脆弱なコード

   <!-- 修正後 -->
   安全なコード

   <!-- 修正の意図 -->
   なぜこの変更で脆弱性が解消されるかの説明（1〜2文）
   ```
7. **修正ステータス**: 未着手 / 修正済み / 対応不要（ユーザー判断）

## 出力に関する注意

- 過剰な一般論や教科書的説明は不要。実装レベルの具体的分析を重視する
- 該当するリスクが存在しないカテゴリは「該当なし」と簡潔に記載する
- レポート末尾に、深刻度別の検出数と修正ステータスのサマリーテーブルを付ける
