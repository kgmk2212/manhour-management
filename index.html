<!DOCTYPE html>

<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工数管理システム</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

    body {
        font-family: 'Segoe UI', 'Yu Gothic', 'Meiryo', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 10px;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        overflow: hidden;
    }

    header {
        background: #2c3e50;
        color: white;
        padding: 20px;
    }

    h1 {
        font-size: 24px;
        margin-bottom: 10px;
    }

    .header-buttons {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }

    .tabs {
        display: flex;
        gap: 5px;
        background: #ecf0f1;
        padding: 10px;
        overflow-x: auto;
    }

    .tab {
        padding: 12px 20px;
        background: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        white-space: nowrap;
    }

    .tab.active {
        background: #3498db;
        color: white;
    }

    .content {
        padding: 20px;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
    }

    .btn-primary {
        background: #3498db;
        color: white;
    }

    .btn-success {
        background: #27ae60;
        color: white;
    }

    .btn-danger {
        background: #e74c3c;
        color: white;
    }

    .btn-small {
        padding: 6px 12px;
        font-size: 12px;
    }

    .form-group {
        margin-bottom: 15px;
    }

    label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
    }

    input, select {
        width: 100%;
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
    }

    .quick-input {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
        border-radius: 10px;
        color: white;
        margin-bottom: 20px;
    }

    .quick-form {
        display: grid;
        gap: 10px;
        margin-top: 15px;
    }

    .table-wrapper {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        background: white;
        min-width: 600px;
    }

    th {
        background: #34495e;
        color: white;
        padding: 12px;
        text-align: left;
        white-space: nowrap;
    }

    td {
        padding: 10px 12px;
        border-bottom: 1px solid #eee;
        white-space: nowrap;
    }

    .badge {
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }

    .badge-ui { background: #e3f2fd; color: #1976d2; }
    .badge-pg { background: #f3e5f5; color: #7b1fa2; }
    .badge-pt { background: #fff3e0; color: #f57c00; }
    .badge-it { background: #e8f5e9; color: #388e3c; }
    .badge-st { background: #fce4ec; color: #c2185b; }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
        border-radius: 10px;
        color: white;
    }

    .stat-card h3 {
        font-size: 14px;
        margin-bottom: 10px;
    }

    .stat-card .value {
        font-size: 32px;
        font-weight: 700;
    }

    @media (max-width: 768px) {
        body {
            padding: 0;
        }

        .container {
            border-radius: 0;
        }

        h1 {
            font-size: 18px;
        }

        .header-buttons {
            flex-direction: column;
        }

        .btn {
            width: 100%;
        }

        .quick-form {
            grid-template-columns: 1fr;
        }

        table {
            font-size: 13px;
        }

        th, td {
            padding: 8px;
        }
    }
</style>

</head>
<body>
    <div class="container">
        <header>
            <h1>工数管理システム</h1>
            <div class="header-buttons">
                <button class="btn btn-success" onclick="exportBackup()">バックアップ</button>
                <button class="btn btn-primary" onclick="importBackup()">復元</button>
            </div>
        </header>

    <div class="tabs">
        <button class="tab active" onclick="showTab('quick')">クイック入力</button>
        <button class="tab" onclick="showTab('estimate')">見積管理</button>
        <button class="tab" onclick="showTab('actual')">実績一覧</button>
        <button class="tab" onclick="showTab('report')">レポート</button>
    </div>

    <div class="content">
        <div id="quick" class="tab-content active">
            <div class="quick-input">
                <h2>今日の実績を入力</h2>
                <div class="quick-form">
                    <div class="form-group">
                        <label>対応選択</label>
                        <select id="quickTask" onchange="autoFillTaskInfo()">
                            <option value="">選択してください</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>工程</label>
                        <input type="text" id="quickProcess" readonly>
                    </div>
                    <div class="form-group">
                        <label>実績工数 (h)</label>
                        <input type="number" id="quickHours" step="0.5" min="0">
                    </div>
                    <button class="btn btn-success" onclick="quickAddActual()">追加</button>
                </div>
            </div>

            <h3>今日の入力済み実績</h3>
            <div id="todayActuals"></div>
        </div>

        <div id="estimate" class="tab-content">
            <h2>見積データ管理</h2>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                <h3>新規見積登録</h3>
                <div class="form-group">
                    <label>版数</label>
                    <input type="text" id="estVersion" placeholder="第2025.11版">
                </div>
                <div class="form-group">
                    <label>対応名</label>
                    <input type="text" id="estTask" placeholder="帳票A_X対応">
                </div>
                <h4>各工程の見積</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                    <div class="form-group">
                        <label>UI (担当)</label>
                        <select id="estUI_member">
                            <option value="">-</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                        </select>
                        <input type="number" id="estUI" placeholder="時間" step="0.5" style="margin-top: 5px;">
                    </div>
                    <div class="form-group">
                        <label>PG (担当)</label>
                        <select id="estPG_member">
                            <option value="">-</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                        </select>
                        <input type="number" id="estPG" placeholder="時間" step="0.5" style="margin-top: 5px;">
                    </div>
                    <div class="form-group">
                        <label>PT (担当)</label>
                        <select id="estPT_member">
                            <option value="">-</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                        </select>
                        <input type="number" id="estPT" placeholder="時間" step="0.5" style="margin-top: 5px;">
                    </div>
                    <div class="form-group">
                        <label>IT (担当)</label>
                        <select id="estIT_member">
                            <option value="">-</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                        </select>
                        <input type="number" id="estIT" placeholder="時間" step="0.5" style="margin-top: 5px;">
                    </div>
                    <div class="form-group">
                        <label>ST (担当)</label>
                        <select id="estST_member">
                            <option value="">-</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                        </select>
                        <input type="number" id="estST" placeholder="時間" step="0.5" style="margin-top: 5px;">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="addEstimate()" style="margin-top: 15px;">登録</button>
            </div>

            <h3>登録済み見積一覧</h3>
            <div id="estimateList"></div>
        </div>

        <div id="actual" class="tab-content">
            <h2>実績データ一覧</h2>
            <div id="actualList"></div>
        </div>

        <div id="report" class="tab-content">
            <h2>工数レポート</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>総見積工数</h3>
                    <div class="value" id="totalEstimate">0h</div>
                </div>
                <div class="stat-card">
                    <h3>総実績工数</h3>
                    <div class="value" id="totalActual">0h</div>
                </div>
                <div class="stat-card">
                    <h3>差異</h3>
                    <div class="value" id="totalDiff">0h</div>
                </div>
                <div class="stat-card">
                    <h3>実績率</h3>
                    <div class="value" id="actualRate">0%</div>
                </div>
            </div>

            <h3>担当者別工数</h3>
            <div id="memberReport"></div>

            <h3 style="margin-top: 20px;">版数別進捗</h3>
            <div id="versionReport"></div>
        </div>
    </div>
</div>

<input type="file" id="fileInput" accept=".json" style="display: none;" onchange="handleFileImport(event)">

<script>
    let estimates = [];
    let actuals = [];

    document.addEventListener('DOMContentLoaded', function() {
        loadData();
        updateQuickTaskList();
        renderEstimateList();
        renderActualList();
        renderTodayActuals();
        updateReport();
    });

    function saveData() {
        localStorage.setItem('manhour_estimates', JSON.stringify(estimates));
        localStorage.setItem('manhour_actuals', JSON.stringify(actuals));
        autoBackup();
    }

    function loadData() {
        const savedEstimates = localStorage.getItem('manhour_estimates');
        const savedActuals = localStorage.getItem('manhour_actuals');
        
        if (savedEstimates) estimates = JSON.parse(savedEstimates);
        if (savedActuals) actuals = JSON.parse(savedActuals);
    }

    function autoBackup() {
        const data = {
            estimates: estimates,
            actuals: actuals,
            timestamp: new Date().toISOString(),
            version: '1.0'
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
        a.href = url;
        a.download = `工数管理_バックアップ_${timestamp}.json`;
        a.click();
        URL.revokeObjectURL(url);
    }

    function showTab(tabName) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        event.target.classList.add('active');
        document.getElementById(tabName).classList.add('active');
    }

    function addEstimate() {
        const version = document.getElementById('estVersion').value;
        const task = document.getElementById('estTask').value;
        
        if (!version || !task) {
            alert('版数と対応名を入力してください');
            return;
        }

        const processes = ['UI', 'PG', 'PT', 'IT', 'ST'];
        
        processes.forEach(proc => {
            const hours = parseFloat(document.getElementById(`est${proc}`).value);
            const member = document.getElementById(`est${proc}_member`).value;
            
            if (hours > 0 && member) {
                estimates.push({
                    id: Date.now() + Math.random(),
                    version: version,
                    task: task,
                    process: proc,
                    member: member,
                    hours: hours,
                    createdAt: new Date().toISOString()
                });
            }
        });

        saveData();
        clearEstimateForm();
        renderEstimateList();
        updateQuickTaskList();
        updateReport();
        alert('見積を登録しました');
    }

    function clearEstimateForm() {
        document.getElementById('estVersion').value = '';
        document.getElementById('estTask').value = '';
        ['UI', 'PG', 'PT', 'IT', 'ST'].forEach(proc => {
            document.getElementById(`est${proc}`).value = '';
            document.getElementById(`est${proc}_member`).value = '';
        });
    }

    function updateQuickTaskList() {
        const select = document.getElementById('quickTask');
        select.innerHTML = '<option value="">選択してください</option>';
        
        const uniqueTasks = [...new Set(estimates.map(e => `${e.version}|${e.task}|${e.process}`))];
        
        uniqueTasks.forEach(task => {
            const [version, taskName, process] = task.split('|');
            const option = document.createElement('option');
            option.value = task;
            option.textContent = `${version} - ${taskName} [${process}]`;
            select.appendChild(option);
        });
    }

    function autoFillTaskInfo() {
        const selected = document.getElementById('quickTask').value;
        if (!selected) {
            document.getElementById('quickProcess').value = '';
            return;
        }
        
        const [version, task, process] = selected.split('|');
        document.getElementById('quickProcess').value = process;
    }

    function quickAddActual() {
        const selected = document.getElementById('quickTask').value;
        const hours = parseFloat(document.getElementById('quickHours').value);
        
        if (!selected || !hours) {
            alert('対応と実績工数を入力してください');
            return;
        }

        const [version, task, process] = selected.split('|');
        const estimate = estimates.find(e => 
            e.version === version && e.task === task && e.process === process
        );

        if (!estimate) {
            alert('見積データが見つかりません');
            return;
        }

        actuals.push({
            id: Date.now(),
            date: new Date().toISOString().split('T')[0],
            version: version,
            task: task,
            process: process,
            member: estimate.member,
            hours: hours,
            createdAt: new Date().toISOString()
        });

        saveData();
        document.getElementById('quickHours').value = '';
        renderTodayActuals();
        renderActualList();
        updateReport();
        alert('実績を追加しました');
    }

    function renderTodayActuals() {
        const today = new Date().toISOString().split('T')[0];
        const todayData = actuals.filter(a => a.date === today);
        
        const container = document.getElementById('todayActuals');
        
        if (todayData.length === 0) {
            container.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">まだ実績が入力されていません</p>';
            return;
        }

        let html = '<div class="table-wrapper"><table><tr><th>時刻</th><th>版数</th><th>対応名</th><th>工程</th><th>工数</th><th>操作</th></tr>';
        
        todayData.forEach(a => {
            const time = new Date(a.createdAt).toLocaleTimeString('ja-JP');
            html += `
                <tr>
                    <td>${time}</td>
                    <td>${a.version}</td>
                    <td>${a.task}</td>
                    <td><span class="badge badge-${a.process.toLowerCase()}">${a.process}</span></td>
                    <td>${a.hours}h</td>
                    <td><button class="btn btn-danger btn-small" onclick="deleteActual(${a.id})">削除</button></td>
                </tr>
            `;
        });
        
        html += '</table></div>';
        container.innerHTML = html;
    }

    function renderEstimateList() {
        const container = document.getElementById('estimateList');
        
        if (estimates.length === 0) {
            container.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">見積データがありません</p>';
            return;
        }

        let html = '<div class="table-wrapper"><table><tr><th>版数</th><th>対応名</th><th>工程</th><th>担当</th><th>見積工数</th><th>操作</th></tr>';
        
        estimates.forEach(e => {
            html += `
                <tr>
                    <td>${e.version}</td>
                    <td>${e.task}</td>
                    <td><span class="badge badge-${e.process.toLowerCase()}">${e.process}</span></td>
                    <td>${e.member}</td>
                    <td>${e.hours}h</td>
                    <td><button class="btn btn-danger btn-small" onclick="deleteEstimate(${e.id})">削除</button></td>
                </tr>
            `;
        });
        
        html += '</table></div>';
        container.innerHTML = html;
    }

    function renderActualList() {
        const container = document.getElementById('actualList');
        
        if (actuals.length === 0) {
            container.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">実績データがありません</p>';
            return;
        }

        let html = '<div class="table-wrapper"><table><tr><th>日付</th><th>版数</th><th>対応名</th><th>工程</th><th>担当</th><th>実績工数</th><th>操作</th></tr>';
        
        const sortedActuals = [...actuals].sort((a, b) => new Date(b.date) - new Date(a.date));
        
        sortedActuals.forEach(a => {
            html += `
                <tr>
                    <td>${a.date}</td>
                    <td>${a.version}</td>
                    <td>${a.task}</td>
                    <td><span class="badge badge-${a.process.toLowerCase()}">${a.process}</span></td>
                    <td>${a.member}</td>
                    <td>${a.hours}h</td>
                    <td><button class="btn btn-danger btn-small" onclick="deleteActual(${a.id})">削除</button></td>
                </tr>
            `;
        });
        
        html += '</table></div>';
        container.innerHTML = html;
    }

    function updateReport() {
        const totalEst = estimates.reduce((sum, e) => sum + e.hours, 0);
        const totalAct = actuals.reduce((sum, a) => sum + a.hours, 0);
        const diff = totalAct - totalEst;
        const rate = totalEst > 0 ? (totalAct / totalEst * 100).toFixed(1) : 0;

        document.getElementById('totalEstimate').textContent = totalEst.toFixed(1) + 'h';
        document.getElementById('totalActual').textContent = totalAct.toFixed(1) + 'h';
        document.getElementById('totalDiff').textContent = (diff >= 0 ? '+' : '') + diff.toFixed(1) + 'h';
        document.getElementById('actualRate').textContent = rate + '%';

        renderMemberReport();
        renderVersionReport();
    }

    function renderMemberReport() {
        const members = ['A', 'B', 'C', 'D'];
        let html = '<div class="table-wrapper"><table><tr><th>担当者</th><th>見積工数</th><th>実績工数</th><th>差異</th><th>差異率</th></tr>';

        members.forEach(member => {
            const est = estimates.filter(e => e.member === member).reduce((sum, e) => sum + e.hours, 0);
            const act = actuals.filter(a => a.member === member).reduce((sum, a) => sum + a.hours, 0);
            const diff = act - est;
            const rate = est > 0 ? ((diff / est) * 100).toFixed(1) : 0;

            html += `
                <tr>
                    <td><strong>${member}</strong></td>
                    <td>${est.toFixed(1)}h</td>
                    <td>${act.toFixed(1)}h</td>
                    <td style="color: ${diff >= 0 ? '#e74c3c' : '#27ae60'}">${(diff >= 0 ? '+' : '')}${diff.toFixed(1)}h</td>
                    <td>${rate}%</td>
                </tr>
            `;
        });

        html += '</table></div>';
        document.getElementById('memberReport').innerHTML = html;
    }

    function renderVersionReport() {
        const versions = [...new Set(estimates.map(e => e.version))];
        let html = '<div class="table-wrapper"><table><tr><th>版数</th><th>見積工数</th><th>実績工数</th><th>進捗率</th></tr>';

        versions.forEach(version => {
            const est = estimates.filter(e => e.version === version).reduce((sum, e) => sum + e.hours, 0);
            const act = actuals.filter(a => a.version === version).reduce((sum, a) => sum + a.hours, 0);
            const progress = est > 0 ? (act / est * 100).toFixed(1) : 0;

            html += `
                <tr>
                    <td><strong>${version}</strong></td>
                    <td>${est.toFixed(1)}h</td>
                    <td>${act.toFixed(1)}h</td>
                    <td>${progress}%</td>
                </tr>
            `;
        });

        html += '</table></div>';
        document.getElementById('versionReport').innerHTML = html;
    }

    function deleteEstimate(id) {
        if (!confirm('この見積を削除しますか?')) return;
        estimates = estimates.filter(e => e.id !== id);
        saveData();
        renderEstimateList();
        updateQuickTaskList();
        updateReport();
        alert('見積を削除しました');
    }

    function deleteActual(id) {
        if (!confirm('この実績を削除しますか?')) return;
        actuals = actuals.filter(a => a.id !== id);
        saveData();
        renderActualList();
        renderTodayActuals();
        updateReport();
        alert('実績を削除しました');
    }

    function exportBackup() {
        autoBackup();
        alert('バックアップを作成しました');
    }

    function importBackup() {
        document.getElementById('fileInput').click();
    }

    function handleFileImport(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                
                if (confirm('現在のデータを復元したデータで上書きしますか？')) {
                    estimates = data.estimates || [];
                    actuals = data.actuals || [];
                    saveData();
                    
                    updateQuickTaskList();
                    renderEstimateList();
                    renderActualList();
                    renderTodayActuals();
                    updateReport();
                    
                    alert('データを復元しました');
                }
            } catch (error) {
                alert('ファイルの読み込みに失敗しました');
            }
        };
        reader.readAsText(file);
        event.target.value = '';
    }
</script>
```

</body>
</html>