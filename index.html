<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工数管理システム</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📊</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@holiday-jp/holiday_jp/holiday_jp.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <!-- 早期テーマ・タブ読み込み：ちらつき防止 -->
    <script>
        (function () {
            try {
                var settings = localStorage.getItem('manhour_settings');
                if (settings) {
                    var parsed = JSON.parse(settings);
                    if (parsed.themeColor) {
                        window.__earlyThemeColor = parsed.themeColor;
                    }
                }
                // 保存されたタブを読み込み
                var savedTab = localStorage.getItem('manhour_currentTab');
                if (savedTab && ['quick', 'estimate', 'actual', 'report', 'settings'].indexOf(savedTab) !== -1) {
                    window.__earlySavedTab = savedTab;
                }
            } catch (e) { }
        })();
    </script>
    <style>
        /* 早期テーマ適用用のCSS変数 */
        :root {
            --early-theme-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>

<body>
    <!-- 早期テーマ適用スクリプト -->
    <script>
        (function () {
            var themeColor = window.__earlyThemeColor || 'purple';
            var gradients = {
                'purple': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'deep-blue': 'linear-gradient(135deg, #1e3c72 0%, #2a5298 100%)',
                'teal': 'linear-gradient(135deg, #0f766e 0%, #0d9488 100%)',
                'cyan': 'linear-gradient(135deg, #0891b2 0%, #06b6d4 100%)',
                'ocean': 'linear-gradient(135deg, #0c4a6e 0%, #075985 100%)',
                'sky': 'linear-gradient(135deg, #0369a1 0%, #0284c7 100%)',
                'indigo': 'linear-gradient(135deg, #4338ca 0%, #6366f1 100%)',
                'navy': 'linear-gradient(135deg, #1e40af 0%, #3b82f6 100%)',
                'slate': 'linear-gradient(135deg, #334155 0%, #475569 100%)',
                'green': 'linear-gradient(135deg, #047857 0%, #059669 100%)',
                'emerald': 'linear-gradient(135deg, #059669 0%, #10b981 100%)'
            };
            var gradient = gradients[themeColor] || gradients['purple'];

            // CSS変数を設定
            document.documentElement.style.setProperty('--early-theme-gradient', gradient);
            document.documentElement.dataset.earlyTheme = themeColor;

            // 保存されたタブを早期適用
            if (window.__earlySavedTab && window.__earlySavedTab !== 'quick') {
                document.documentElement.dataset.earlyTab = window.__earlySavedTab;
            }
        })();
    </script>
    <style>
        /* 早期テーマ適用 */
        [data-early-theme] .tab.active,
        [data-early-theme] .quick-input.theme-bg,
        [data-early-theme] .stat-card.theme-bg {
            background: var(--early-theme-gradient) !important;
        }

        /* セグメントボタンのちらつき防止 */
        [data-early-theme] .segment-buttons button.active {
            background: var(--early-theme-gradient) !important;
            color: white !important;
        }

        [data-early-theme] .segment-buttons button:not(.active) {
            background: white !important;
            color: #333 !important;
        }

        /* ページ読込中の背景安定化 */
        body {
            background: var(--early-theme-gradient, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
        }

        /* 早期タブ適用：デフォルトのquickタブを非表示にし、保存タブを表示 */
        [data-early-tab] #quick.tab-content.active {
            display: none !important;
        }

        [data-early-tab="estimate"] #estimate.tab-content {
            display: block !important;
        }

        [data-early-tab="actual"] #actual.tab-content {
            display: block !important;
        }

        [data-early-tab="report"] #report.tab-content {
            display: block !important;
        }

        [data-early-tab="settings"] #settings.tab-content {
            display: block !important;
        }
    </style>
    <div class="container">
        <header>
            <h1>工数管理システム</h1>
            <div class="header-buttons">
                <button class="btn btn-success" id="btnExportBackup">バックアップ</button>
                <button class="btn btn-primary" id="btnImportBackup">復元</button>
            </div>
        </header>

        <div class="tabs">
            <button class="tab active tab-theme-purple" data-tab="quick">クイック入力</button>
            <button class="tab" data-tab="report">レポート</button>
            <button class="tab" data-tab="estimate">見積一覧</button>
            <button class="tab" data-tab="actual">実績一覧</button>
            <button class="tab" data-tab="settings">⚙️ 設定</button>
        </div>

        <div class="content">
            <div id="quick" class="tab-content active">
                <div class="quick-input theme-bg theme-purple">
                    <h2 id="quickModeTitle">今日の実績を入力</h2>

                    <!-- セグメントボタンを右側に配置 -->
                    <div style="display: flex; justify-content: flex-end; margin-bottom: 20px;">
                        <div class="segment-buttons">
                            <button id="quickActualModeBtn" class="active">実績入力</button>
                            <button id="quickEstimateModeBtn">見積登録</button>
                            <button id="quickVacationModeBtn">休暇登録</button>
                        </div>
                    </div>

                    <!-- 実績入力フォーム -->
                    <div id="quickActualForm" class="quick-form">


                        <!-- 1. 作業日 (一番上) -->
                        <div class="form-group quick-form-date">
                            <label>作業日</label>
                            <input type="date" id="quickWorkDate"
                                style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; width: 100%; max-width: 100%; box-sizing: border-box;">
                        </div>

                        <!-- 2. 対応検索 -->
                        <div class="form-group">
                            <label>対応検索・選択</label>
                            <div style="position: relative;">
                                <input type="text" id="quickTaskSearch" placeholder="クリックして対応を選択..." autocomplete="off"
                                    style="padding-right: 35px; background: rgba(255,255,255,0.95); color: #333; border: none;">
                                <button id="quickTaskClearBtn"
                                    style="display: none; position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #666; cursor: pointer; font-size: 18px; padding: 4px 8px; line-height: 1;"
                                    title="クリア">×</button>
                                <div id="quickTaskDropdown" class="custom-dropdown" style="display: none;">
                                    <!-- JavaScriptで動的に生成 -->
                                </div>
                            </div>
                        </div>

                        <!-- 3. 担当・時間 (2列グリッド) -->
                        <div class="quick-form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div class="form-group quick-form-member">
                                <label>担当</label>
                                <select id="quickMemberSelect"
                                    style="background: rgba(255,255,255,0.95); color: #333; border: none;">
                                    <option value="">（自動）</option>
                                </select>
                                <small style="color: rgba(255,255,255,0.7); font-size: 11px;">通常は自動</small>
                            </div>
                            <div class="form-group quick-form-hours">
                                <label>実績工数 (h)</label>
                                <input type="number" id="quickHours" step="0.5" min="0" value="8"
                                    style="background: rgba(255,255,255,0.95); color: #333; border: none;">
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-success" id="btnQuickAddActual" style="flex: 2;">追加</button>
                            <button class="btn" id="btnOpenOtherWork"
                                style="flex: 1; background: rgba(255,255,255,0.2); color: white;">その他</button>
                        </div>

                    </div>

                    <!-- 見積登録フォーム -->
                    <div id="quickEstimateForm" class="quick-form" style="display: none;">
                        <div class="form-group">
                            <label>版数</label>
                            <select id="quickEstVersion">
                                <option value="">-- 版数を選択 --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>帳票名</label>
                            <select id="quickEstFormNameSelect"
                                style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white;">
                                <option value="">-- 帳票名を選択 --</option>
                                <option value="__new__">新規入力</option>
                            </select>
                            <input type="text" id="quickEstFormName" placeholder="帳票A"
                                style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; display: none;">
                            <small
                                style="color: rgba(255,255,255,0.7); display: block; margin-top: 5px; font-size: 11px;">既存の帳票名を選択、または新規入力できます</small>
                        </div>
                        <div class="form-group">
                            <label>対応名</label>
                            <input type="text" id="quickEstTask" placeholder="X対応"
                                style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white;">
                        </div>
                        <div class="form-group">
                            <label>作業月</label>
                            <div style="display: flex; gap: 12px; margin-bottom: 8px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="quickEstMonthType" value="single" checked
                                        style="width: auto; margin-right: 4px;">
                                    <span style="color: rgba(255,255,255,0.75); font-size: 11px;">単一月</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="quickEstMonthType" value="multi"
                                        style="width: auto; margin-right: 4px;">
                                    <span style="color: rgba(255,255,255,0.75); font-size: 11px;">複数月</span>
                                </label>
                            </div>
                            <div id="quickEstMonthInputs">
                                <div id="quickEstSingleMonthInput" style="display: block;">
                                    <select id="quickEstStartMonth"></select>
                                </div>
                                <div id="quickEstMultiMonthInput" style="display: none;">
                                    <div style="display: flex; gap: 10px; align-items: center;">
                                        <select id="quickEstStartMonthMulti"></select>
                                        <span>〜</span>
                                        <select id="quickEstEndMonth"></select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <h4 style="margin-bottom: 10px; color: rgba(255,255,255,0.9);">各工程の見積</h4>
                        <div class="estimate-table-wrapper">
                            <table class="estimate-table" id="quickEstimateTable" style="width: 100%; margin: 0;">
                                <thead>
                                    <tr>
                                        <th style="width: 60px; padding: 8px; text-align: center;">工程</th>
                                        <th style="width: 120px; padding: 8px;">担当</th>
                                        <th style="width: 100px; padding: 8px;">時間</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="text-align: center; font-weight: 600;"><span
                                                class="badge badge-ui">UI</span></td>
                                        <td><select id="quickEstUI_member" style="margin: 0;"></select></td>
                                        <td><input type="number" id="quickEstUI" placeholder="h" step="0.5"
                                                style="margin: 0;"></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: center; font-weight: 600;"><span
                                                class="badge badge-pg">PG</span></td>
                                        <td><select id="quickEstPG_member" style="margin: 0;"></select></td>
                                        <td><input type="number" id="quickEstPG" placeholder="h" step="0.5"
                                                style="margin: 0;"></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: center; font-weight: 600;"><span
                                                class="badge badge-pt">PT</span></td>
                                        <td><select id="quickEstPT_member" style="margin: 0;"></select></td>
                                        <td><input type="number" id="quickEstPT" placeholder="h" step="0.5"
                                                style="margin: 0;"></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: center; font-weight: 600;"><span
                                                class="badge badge-it">IT</span></td>
                                        <td><select id="quickEstIT_member" style="margin: 0;"></select></td>
                                        <td><input type="number" id="quickEstIT" placeholder="h" step="0.5"
                                                style="margin: 0;"></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: center; font-weight: 600;"><span
                                                class="badge badge-st">ST</span></td>
                                        <td><select id="quickEstST_member" style="margin: 0;"></select></td>
                                        <td><input type="number" id="quickEstST" placeholder="h" step="0.5"
                                                style="margin: 0;"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- 合計表示エリア -->
                        <div id="quickEstimateTotals"
                            style="background: rgba(25, 118, 210, 0.15); padding: 12px 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #1976d2;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                                <span style="font-weight: 600; color: rgba(255,255,255,0.9);">対応合計:</span>
                                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                                    <span style="color: rgba(255,255,255,0.95);"><strong
                                            id="quickEstTotalHours">0.0</strong> h</span>
                                    <span style="color: rgba(255,255,255,0.8);">(<span id="quickEstTotalDays">0.0</span>
                                        人日)</span>
                                    <span style="color: rgba(255,255,255,0.8);">(<span
                                            id="quickEstTotalMonths">0.00</span>
                                        人月)</span>
                                </div>
                            </div>
                        </div>

                        <!-- 月分割アシスタント -->
                        <div
                            style="background: rgba(251, 146, 60, 0.15); padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #fb923c;">
                            <div class="form-group" style="margin-bottom: 10px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="quickEnableMonthSplit" onchange="toggleQuickMonthSplit()"
                                        style="width: auto; margin-right: 10px;">
                                    <span style="font-weight: 600; color: #ea580c;">📅 複数月に分割して登録</span>
                                </label>
                                <small style="color: rgba(255,255,255,0.8); display: block; margin-top: 5px;">
                                    一つの工程を複数月で作業する場合に、月別の工数を設定できます
                                </small>
                            </div>

                            <div id="quickMonthSplitPanel" style="display: none; margin-top: 15px;">
                                <div class="form-group">
                                    <label>分割する工程を選択</label>
                                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                                        <label style="display: flex; align-items: center; cursor: pointer;">
                                            <input type="checkbox" id="quickSplitUI"
                                                class="quick-split-process-checkbox"
                                                style="width: auto; margin-right: 5px;">
                                            <span>UI</span>
                                        </label>
                                        <label style="display: flex; align-items: center; cursor: pointer;">
                                            <input type="checkbox" id="quickSplitPG"
                                                class="quick-split-process-checkbox"
                                                style="width: auto; margin-right: 5px;">
                                            <span>PG</span>
                                        </label>
                                        <label style="display: flex; align-items: center; cursor: pointer;">
                                            <input type="checkbox" id="quickSplitPT"
                                                class="quick-split-process-checkbox"
                                                style="width: auto; margin-right: 5px;">
                                            <span>PT</span>
                                        </label>
                                        <label style="display: flex; align-items: center; cursor: pointer;">
                                            <input type="checkbox" id="quickSplitIT"
                                                class="quick-split-process-checkbox"
                                                style="width: auto; margin-right: 5px;">
                                            <span>IT</span>
                                        </label>
                                        <label style="display: flex; align-items: center; cursor: pointer;">
                                            <input type="checkbox" id="quickSplitST"
                                                class="quick-split-process-checkbox"
                                                style="width: auto; margin-right: 5px;">
                                            <span>ST</span>
                                        </label>
                                    </div>
                                    <small style="color: rgba(255,255,255,0.7); display: block; margin-top: 5px;">
                                        チェックした工程のみが月分割されます。チェックしていない工程は通常通り登録されます。
                                    </small>
                                </div>

                                <div class="form-group">
                                    <label>総工数</label>
                                    <input type="number" id="quickTotalHours" step="0.1" min="0" placeholder="例: 80">
                                    <span style="margin-left: 5px;">時間</span>
                                </div>

                                <div class="form-group">
                                    <label>作業期間</label>
                                    <div style="display: flex; gap: 10px; align-items: center;">
                                        <select id="quickStartMonth"></select>
                                        <span>〜</span>
                                        <select id="quickEndMonth"></select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>分割方法</label>
                                    <div style="display: flex; gap: 20px;">
                                        <label style="display: flex; align-items: center; cursor: pointer;">
                                            <input type="radio" name="quickSplitMethod" value="equal" checked
                                                style="width: auto; margin-right: 5px;">
                                            <span>均等分割</span>
                                        </label>
                                        <label style="display: flex; align-items: center; cursor: pointer;">
                                            <input type="radio" name="quickSplitMethod" value="manual"
                                                style="width: auto; margin-right: 5px;">
                                            <span>手動設定</span>
                                        </label>
                                    </div>
                                </div>

                                <div id="quickMonthPreview" style="margin-top: 15px;"></div>
                            </div>
                        </div>

                        <button class="btn" id="btnAddQuickEstimate"
                            style="margin-top: 15px; background: rgba(255,255,255,0.9); color: #7b3ff2; font-weight: 600;">登録</button>
                    </div>

                    <!-- 休暇登録フォーム -->
                    <div id="quickVacationForm" class="quick-form" style="display: none;">
                        <div class="form-group">
                            <label>担当者</label>
                            <select id="quickVacationMember">
                            </select>
                        </div>
                        <div class="form-group">
                            <label>日付</label>
                            <input type="date" id="quickVacationDate" style="max-width: 200px;">
                        </div>
                        <div class="form-group">
                            <label>休暇タイプ</label>
                            <select id="quickVacationType">
                                <option value="有休">有給休暇（有休）</option>
                                <option value="特休">特別休暇（特休）</option>
                                <option value="代休">代休（代休）</option>
                                <option value="振休">振替休日（振休）</option>
                                <option value="時間休">時間休</option>
                            </select>
                        </div>
                        <div class="form-group" id="quickVacationHoursGroup">
                            <label>時間数 (h)</label>
                            <input type="number" id="quickVacationHours" step="1" min="1" placeholder="1" value="8">
                            <small style="color: rgba(255,255,255,0.8); display: block; margin-top: 5px;">
                                時間休は1h単位で入力してください。全日休暇は8hです。
                            </small>
                        </div>
                        <button class="btn" id="btnAddQuickVacation"
                            style="background: rgba(255,255,255,0.9); color: #7b3ff2; font-weight: 600;">登録</button>
                    </div>
                </div>

                <h3 id="quickBottomTitle">今日の入力済み実績</h3>
                <div id="todayActuals"></div>
            </div>

            <div id="report" class="tab-content">
                <h2>工数レポート</h2>

                <!-- バージョン1: 横並びコンパクトレイアウト -->
                <div id="reportFiltersCompact" class="sticky-filter-container"
                    style="display: flex; flex-wrap: nowrap; gap: 10px; align-items: center; margin-bottom: 20px; background: #f8f9fa; padding: 10px; border-radius: 6px; overflow-x: auto;">
                    <div style="display: flex; align-items: center; gap: 5px; flex-shrink: 0;">
                        <label style="font-size: 12px; font-weight: 500; white-space: nowrap;">フィルタ:</label>
                        <select id="reportFilterType" style="padding: 3px 6px; font-size: 12px;">
                            <option value="month">月別</option>
                            <option value="version">版数別</option>
                        </select>
                    </div>
                    <div id="reportMonthFilterCompact"
                        style="display: flex; align-items: center; gap: 5px; flex-shrink: 0;">
                        <label style="font-size: 12px; font-weight: 500; white-space: nowrap;">表示月:</label>
                        <select id="reportMonth" style="padding: 3px 6px; font-size: 12px;">
                            <option value="all">全期間</option>
                        </select>
                    </div>
                    <div id="reportVersionFilterCompact"
                        style="display: none; align-items: center; gap: 5px; flex-shrink: 0;">
                        <label style="font-size: 12px; font-weight: 500; white-space: nowrap;">版数:</label>
                        <select id="reportVersion" style="padding: 3px 6px; font-size: 12px;">
                            <option value="all">全版数</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px; flex-shrink: 0;">
                        <label style="font-size: 12px; font-weight: 500; white-space: nowrap;">表示形式:</label>
                        <select id="reportViewType" style="padding: 3px 6px; font-size: 12px;">
                            <option value="summary">サマリー</option>
                            <option value="grouped" selected>グループ</option>
                            <option value="matrix">マトリクス</option>
                        </select>
                    </div>
                </div>

                <!-- バージョン2: セグメントボタンレイアウト（切り替え用） -->
                <div id="reportFiltersSegmented" class="sticky-filter-container"
                    style="display: none; margin-bottom: 20px; background: #f8f9fa; padding: 12px; border-radius: 6px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 12px; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <label style="font-size: 13px; font-weight: 500; white-space: nowrap;">フィルタ:</label>
                            <div class="segment-buttons">
                                <button id="btnFilterMonth" class="active">月別</button>
                                <button id="btnFilterVersion">版数別</button>
                            </div>
                        </div>
                        <div id="reportMonthFilterSegmented" style="display: flex; align-items: center; gap: 6px;">
                            <label style="font-size: 13px; font-weight: 500; white-space: nowrap;">表示月:</label>
                            <!-- セグメントボタン版 -->
                            <div id="reportMonthButtons2" class="segment-buttons"
                                style="max-width: min(800px, calc(100vw - 130px));">
                            </div>
                            <!-- Select版（要素数が多い場合） -->
                            <select id="reportMonth2" style="padding: 4px 8px; font-size: 13px; display: none;">
                                <option value="all">全期間</option>
                            </select>
                        </div>
                        <div id="reportVersionFilterSegmented" style="display: none; align-items: center; gap: 6px;">
                            <label style="font-size: 13px; font-weight: 500; white-space: nowrap;">版数:</label>
                            <!-- セグメントボタン版 -->
                            <div id="reportVersionButtons2" class="segment-buttons"
                                style="max-width: min(800px, calc(100vw - 110px));">
                            </div>
                            <!-- Select版（要素数が多い場合） -->
                            <select id="reportVersion2" style="padding: 4px 8px; font-size: 13px; display: none;">
                                <option value="all">全版数</option>
                            </select>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <label style="font-size: 13px; font-weight: 500; white-space: nowrap;">表示形式:</label>
                            <div class="segment-buttons">
                                <button id="btnReportSummary">サマリー</button>
                                <button id="btnReportGrouped" class="active">グループ</button>
                                <button id="btnReportMatrix">マトリクス</button>
                            </div>
                        </div>
                    </div>
                </div>

                <h3 id="reportPeriodTitle">全期間の集計</h3>

                <!-- 換算基準表示エリア -->
                <div id="reportConversionParams"
                    style="margin-bottom: 15px; background: #e3f2fd; padding: 10px 15px; border-radius: 6px; font-size: 13px; color: #1565c0; display: none;">
                </div>



                <div class="stats-grid">
                    <div class="stat-card theme-bg theme-purple">
                        <h3>総見積工数</h3>
                        <div class="value" id="totalEstimate">0h</div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.8); margin-top: 5px;"
                            id="totalEstimateManpower"></div>
                    </div>
                    <div class="stat-card theme-bg theme-purple">
                        <h3>総実績工数</h3>
                        <div class="value" id="totalActual">0h</div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.8); margin-top: 5px;"
                            id="totalActualManpower"></div>
                    </div>
                    <div class="stat-card theme-bg theme-purple">
                        <h3>差異</h3>
                        <div class="value" id="totalDiff">0h</div>
                    </div>
                    <div class="stat-card theme-bg theme-purple">
                        <h3>実績率</h3>
                        <div class="value" id="actualRate">0%</div>
                    </div>
                </div>



                <div id="reportDetailView"></div>

                <h3>担当者別工数</h3>
                <div id="memberReport"></div>

                <h3 style="margin-top: 20px;">版数別進捗</h3>
                <div id="versionReport"></div>

                <!-- 進捗管理セクション -->
                <div style="margin-top: 30px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <h3>進捗管理（見込残存時間ベース）</h3>
                    <p style="color: #666; margin-bottom: 15px; font-size: 13px;">
                        見込残存時間を入力すると、より正確な進捗率と予測総工数が表示されます。
                    </p>

                    <!-- フィルタ -->
                    <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: center;">
                        <select id="progressVersionFilter"
                            style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px;">
                            <option value="all">全版数</option>
                        </select>
                        <select id="progressStatusFilter"
                            style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px;">
                            <option value="all">全ステータス</option>
                            <option value="completed">完了</option>
                            <option value="ontrack">順調</option>
                            <option value="warning">注意</option>
                            <option value="exceeded">超過</option>
                        </select>
                        <button class="btn btn-primary" id="btnOpenBulkRemaining"
                            style="padding: 8px 16px; font-size: 13px;">
                            一括編集
                        </button>
                    </div>

                    <!-- 進捗サマリーカード -->
                    <div class="stats-grid" id="progressSummaryCards">
                        <!-- 動的に生成 -->
                    </div>

                    <!-- 詳細テーブル -->
                    <div id="progressDetailTable" style="margin-top: 20px;">
                        <!-- 動的に生成 -->
                    </div>
                </div>

                <!-- Excel出力セクション -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 30px 0;">
                    <h3>📊 Excel出力</h3>
                    <p style="color: #666; margin-bottom: 15px;">実績データと見積データをExcel形式で出力します。</p>

                    <div style="margin-bottom: 15px;">
                        <h4 style="margin-bottom: 8px; font-size: 14px;">出力内容:</h4>
                        <ul style="color: #666; font-size: 13px; margin-left: 20px;">
                            <li><strong>実績シート（担当者別）:</strong> 日付、曜日、備考、作業、時間</li>
                            <li><strong>見積シート:</strong> 版数、作業月、対応名、工程、担当、見積工数</li>
                        </ul>
                    </div>

                    <button class="btn btn-success" id="btnExportExcel" style="font-weight: 600;">
                        📥 Excelファイルをダウンロード
                    </button>
                </div>
            </div>

            <div id="estimate" class="tab-content">
                <h2>見積一覧</h2>

                <!-- 合計工数表示 -->
                <div id="estimateTotalCard"
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 20px; border-radius: 8px; margin-bottom: 20px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div>
                            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">合計工数</div>
                            <div style="font-size: 28px; font-weight: bold;" id="estimateTotalHours">0h</div>
                        </div>
                        <div>
                            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">人日 / 人月</div>
                            <div style="font-size: 18px; font-weight: 600;" id="estimateTotalManpower">0人日 / 0人月
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 担当者別合計表示 -->
                <div id="estimateMemberSummary"
                    style="background: #f8f9fa; padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; display: none;">
                    <div style="font-size: 14px; font-weight: 600; color: #495057; margin-bottom: 10px;">担当者別合計
                    </div>
                    <div id="estimateMemberSummaryContent" style="display: flex; flex-wrap: wrap; gap: 12px;">
                    </div>
                </div>

                <!-- 新規登録ボタン -->
                <button class="btn btn-primary" id="btnOpenAddEstimateModal"
                    style="margin-bottom: 15px; font-weight: 600; display: inline-flex; align-items: center; gap: 6px;">
                    <span style="font-size: 16px;">+</span> 新規登録
                </button>

                <!-- バージョン1: 横並びコンパクトレイアウト -->
                <div id="estimateFiltersCompact" class="sticky-filter-container" style="margin-bottom: 20px;">
                    <div
                        style="display: flex; flex-wrap: nowrap; gap: 10px; align-items: center; background: #f8f9fa; padding: 10px; border-radius: 6px; overflow-x: auto;">
                        <div style="display: flex; align-items: center; gap: 5px; flex-shrink: 0;">
                            <label style="font-size: 12px; font-weight: 500; white-space: nowrap;">フィルタ:</label>
                            <select id="estimateFilterType" style="padding: 3px 6px; font-size: 12px;">
                                <option value="month">月別</option>
                                <option value="version">版数別</option>
                            </select>
                        </div>
                        <div id="estimateMonthFilterCompact"
                            style="display: flex; align-items: center; gap: 5px; flex-shrink: 0;">
                            <label style="font-size: 12px; font-weight: 500; white-space: nowrap;">表示月:</label>
                            <select id="estimateMonthFilter" style="padding: 3px 6px; font-size: 12px;">
                                <option value="all">全期間</option>
                            </select>
                        </div>
                        <div id="estimateVersionFilterCompact"
                            style="display: none; align-items: center; gap: 5px; flex-shrink: 0;">
                            <label style="font-size: 12px; font-weight: 500; white-space: nowrap;">版数:</label>
                            <select id="estimateVersionFilter" style="padding: 3px 6px; font-size: 12px;">
                                <option value="all">全版数</option>
                            </select>
                        </div>
                        <div style="display: flex; align-items: center; gap: 5px; flex-shrink: 0;">
                            <label style="font-size: 12px; font-weight: 500; white-space: nowrap;">表示形式:</label>
                            <select id="estimateViewType" style="padding: 3px 6px; font-size: 12px;">
                                <option value="grouped">グループ</option>
                                <option value="matrix">マトリクス</option>
                                <option value="list">リスト</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: flex-end; gap: 15px; margin-top: 10px;">
                        <label
                            style="display: flex; align-items: center; cursor: pointer; user-select: none; font-size: 12px; font-weight: 500; white-space: nowrap;">
                            <input type="checkbox" id="workMonthSelectionMode" style="width: auto; margin-right: 5px;">
                            <span>作業月割り当て</span>
                        </label>
                        <label
                            style="display: flex; align-items: center; cursor: pointer; user-select: none; font-size: 12px; font-weight: 500; white-space: nowrap;">
                            <input type="checkbox" id="estimateEditMode" style="width: auto; margin-right: 5px;">
                            <span>編集モード</span>
                        </label>
                    </div>
                </div>

                <!-- バージョン2: セグメントボタンレイアウト（切り替え用） -->
                <div id="estimateFiltersSegmented" class="sticky-filter-container"
                    style="display: none; margin-bottom: 20px; background: #f8f9fa; padding: 12px; border-radius: 6px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 12px; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <label style="font-size: 13px; font-weight: 500; white-space: nowrap;">フィルタ:</label>
                            <div class="segment-buttons">
                                <button id="btnEstimateFilterMonth" class="active">月別</button>
                                <button id="btnEstimateFilterVersion">版数別</button>
                            </div>
                        </div>

                        <div id="estimateMonthFilterSegmented" style="display: flex; align-items: center; gap: 6px;">
                            <label style="font-size: 13px; font-weight: 500; white-space: nowrap;">表示月:</label>
                            <!-- セグメントボタン版 -->
                            <div id="estimateMonthButtons2" class="segment-buttons"
                                style="max-width: min(800px, calc(100vw - 130px));">
                            </div>
                            <!-- Select版（セグメントボタン生成用に必要） -->
                            <select id="estimateMonthFilter2" style="padding: 4px 8px; font-size: 13px; display: none;">
                                <option value="all">全期間</option>
                            </select>
                        </div>

                        <div id="estimateVersionFilterSegmented" style="display: none; align-items: center; gap: 6px;">
                            <label style="font-size: 13px; font-weight: 500; white-space: nowrap;">版数:</label>
                            <!-- セグメントボタン版 -->
                            <div id="estimateVersionButtons2" class="segment-buttons"
                                style="max-width: min(800px, calc(100vw - 110px));">
                            </div>
                            <!-- Select版（セグメントボタン生成用に必要） -->
                            <select id="estimateVersionFilter2"
                                style="padding: 4px 8px; font-size: 13px; display: none;">
                                <option value="all">全版数</option>
                            </select>
                        </div>

                        <div style="display: flex; align-items: center; gap: 6px;">
                            <label style="font-size: 13px; font-weight: 500; white-space: nowrap;">表示形式:</label>
                            <div class="segment-buttons">
                                <button id="btnEstimateGrouped" class="active">グループ</button>
                                <button id="btnEstimateMatrix">マトリクス</button>
                                <button id="btnEstimateList">リスト</button>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: flex-end; gap: 15px; margin-top: 10px;">
                        <label
                            style="display: flex; align-items: center; cursor: pointer; user-select: none; font-size: 13px; font-weight: 500; white-space: nowrap;">
                            <input type="checkbox" id="workMonthSelectionMode2" style="width: auto; margin-right: 5px;">
                            <span>作業月割り当て</span>
                        </label>
                        <label
                            style="display: flex; align-items: center; cursor: pointer; user-select: none; font-size: 13px; font-weight: 500; white-space: nowrap;">
                            <input type="checkbox" id="estimateEditMode2" style="width: auto; margin-right: 5px;">
                            <span>編集モード</span>
                        </label>
                    </div>
                </div>

                <!-- 作業月割り当てモード（フロート表示） -->
                <div id="workMonthAssignmentMode"
                    style="display: none; background: linear-gradient(135deg, #fff3cd 0%, #ffe5a0 100%); padding: 18px; border-radius: 8px; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; box-shadow: 0 4px 20px rgba(0,0,0,0.2); border-left: 4px solid #ffc107; max-width: 90vw;">
                    <!-- ドラッグハンドル -->
                    <div id="dragHandle"
                        style="position: absolute; top: 0; left: 0; right: 0; height: 8px; background: rgba(0,0,0,0.1); border-radius: 8px 8px 0 0; cursor: ns-resize; display: flex; align-items: center; justify-content: center; z-index: 1;">
                        <div style="width: 40px; height: 4px; background: rgba(0,0,0,0.3); border-radius: 2px;">
                        </div>
                    </div>

                    <!-- 閉じるボタン -->
                    <!-- 閉じるボタン -->
                    <button id="btnCloseWorkMonthAssignmentMode"
                        style="position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.9); border: 2px solid #856404; font-size: 20px; font-weight: bold; color: #856404; cursor: pointer; padding: 0; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 50%; z-index: 10; box-shadow: 0 2px 4px rgba(0,0,0,0.2); line-height: 1;"
                        onmouseover="this.style.background='#856404'; this.style.color='white';"
                        onmouseout="this.style.background='rgba(255,255,255,0.9)'; this.style.color='#856404';">&times;</button>

                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap; margin-top: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <label style="font-weight: 600; color: #856404;">割り当て先:</label>
                            <select id="assignWorkMonth"
                                style="padding: 8px 12px; border: 2px solid #ffc107; border-radius: 6px; font-weight: 500; font-size: 14px; background: white;">
                            </select>
                        </div>
                        <button class="btn btn-success" id="btnExecuteWorkMonthAssignment"
                            style="margin: 0; font-weight: 600; padding: 8px 20px;">
                            ✓ 割り当て実行
                        </button>
                        <button class="btn" id="btnCancelWorkMonthSelection"
                            style="margin: 0; background: #6c757d; color: white; padding: 8px 16px;">
                            選択解除
                        </button>
                        <div id="selectedWorkHours"
                            style="margin-left: auto; font-weight: 700; font-size: 18px; color: #1976d2; white-space: nowrap;">
                            選択中: 0h (0人日 / 0人月)
                        </div>
                    </div>
                </div>



                <!-- 換算基準表示エリア -->
                <div id="estimateConversionParams"
                    style="margin-bottom: 15px; margin-top: 0px; background: #e3f2fd; padding: 10px 15px; border-radius: 6px; font-size: 13px; color: #1565c0; display: none;">
                </div>

                <div id="estimateList"></div>

                <div id="estimateMemberSummary" style="margin-top: 30px; display: none;"></div>


            </div>

            <div id="actual" class="tab-content">
                <h2>実績データ一覧</h2>

                <!-- バージョン1: 横並びコンパクトレイアウト -->
                <div id="actualFiltersCompact"
                    style="display: flex; flex-wrap: nowrap; gap: 10px; align-items: center; margin-bottom: 20px; background: #f8f9fa; padding: 10px; border-radius: 6px; overflow-x: auto;">
                    <div style="display: flex; align-items: center; gap: 5px; flex-shrink: 0;">
                        <label style="font-size: 12px; font-weight: 500; white-space: nowrap;">表示モード:</label>
                        <select id="actualViewMode" style="padding: 3px 6px; font-size: 12px;">
                            <option value="all">全担当者</option>
                            <option value="member">担当者別</option>
                        </select>
                    </div>

                    <div id="memberSelectGroup" style="display: none; align-items: center; gap: 5px; flex-shrink: 0;">
                        <label style="font-size: 12px; font-weight: 500; white-space: nowrap;">担当者:</label>
                        <select id="actualMemberSelect" style="padding: 3px 6px; font-size: 12px;">
                        </select>
                    </div>

                    <div style="display: flex; align-items: center; gap: 5px; flex-shrink: 0;">
                        <label style="font-size: 12px; font-weight: 500; white-space: nowrap;">表示形式:</label>
                        <select id="actualViewType" style="padding: 3px 6px; font-size: 12px;">
                            <option value="matrix">カレンダー</option>
                            <option value="list">リスト</option>
                        </select>
                    </div>

                    <div style="display: flex; align-items: center; gap: 5px; flex-shrink: 0;">
                        <label style="font-size: 12px; font-weight: 500; white-space: nowrap;">表示期間:</label>
                        <select id="actualMonthFilter" style="padding: 3px 6px; font-size: 12px;">
                            <option value="all">全期間</option>
                        </select>
                    </div>
                </div>

                <!-- バージョン2: セグメントボタンレイアウト（切り替え用） -->
                <div id="actualFiltersSegmented"
                    style="display: none; margin-bottom: 20px; background: #f8f9fa; padding: 12px; border-radius: 6px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 12px; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <label style="font-size: 13px; font-weight: 500; white-space: nowrap;">表示モード:</label>
                            <select id="actualViewMode2" style="padding: 4px 8px; font-size: 13px;">
                                <option value="all">全担当者</option>
                                <option value="member">担当者別</option>
                            </select>
                        </div>

                        <div id="memberSelectGroup2" style="display: none; align-items: center; gap: 6px;">
                            <label style="font-size: 13px; font-weight: 500; white-space: nowrap;">担当者:</label>
                            <!-- セグメントボタン版 -->
                            <div id="actualMemberButtons2" class="segment-buttons"
                                style="max-width: min(600px, calc(100vw - 120px));">
                            </div>
                            <!-- Select版（要素数が多い場合） -->
                            <select id="actualMemberSelect2" style="padding: 4px 8px; font-size: 13px; display: none;">
                            </select>
                        </div>

                        <div style="display: flex; align-items: center; gap: 6px;">
                            <label style="font-size: 13px; font-weight: 500; white-space: nowrap;">表示形式:</label>
                            <div class="segment-buttons">
                                <button id="btnActualMatrix" class="active">カレンダー</button>
                                <button id="btnActualList">リスト</button>
                            </div>
                        </div>

                        <div style="display: flex; align-items: center; gap: 6px;">
                            <label style="font-size: 13px; font-weight: 500; white-space: nowrap;">表示期間:</label>
                            <!-- セグメントボタン版 -->
                            <div id="actualMonthButtons2" class="segment-buttons"
                                style="max-width: min(800px, calc(100vw - 140px));">
                            </div>
                            <!-- Select版（要素数が多い場合） -->
                            <select id="actualMonthFilter2" style="padding: 4px 8px; font-size: 13px; display: none;">
                                <option value="all">全期間</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="actualList"></div>
            </div>
            <!-- /report -->

            <div id="settings" class="tab-content">
                <h2>⚙️ 設定</h2>

                <!-- テーマカラー設定 -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>🎨 テーマカラー</h3>
                    <p style="color: #666; margin-bottom: 15px;">アプリの配色を変更できます。クイック入力エリア、レポート集計、アクティブタブに適用されます。</p>

                    <div class="form-group">
                        <label>色</label>
                        <select id="themeColor">
                            <option value="purple">紫（現在）</option>
                            <option value="deep-blue">ディープブルー</option>
                            <option value="teal">ティール</option>
                            <option value="cyan">シアン</option>
                            <option value="ocean">オーシャン</option>
                            <option value="sky">スカイブルー</option>
                            <option value="indigo">インディゴ</option>
                            <option value="navy">ネイビー</option>
                            <option value="slate">スレート</option>
                            <option value="green">グリーン</option>
                            <option value="emerald">エメラルド</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>デザイン</label>
                        <select id="themePattern">
                            <option value="none">シンプル（模様なし）</option>
                            <option value="wave">波模様</option>
                            <option value="stripe">右ストライプ</option>
                            <option value="glow">グロー効果</option>
                            <option value="corner">コーナーアクセント</option>
                            <option value="dot">ドット</option>
                            <option value="dots">複数ドット</option>
                            <option value="diagonal">斜線パターン</option>
                            <option value="circle">サークル</option>
                            <option value="layer">レイヤー</option>
                            <option value="line">グラデーションライン</option>
                            <option value="bar">左バー</option>
                            <option value="border">上部ボーダー</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>タブの色</label>
                        <select id="themeTabColor">
                            <option value="same">メインカラーと同じ</option>
                            <option value="default">デフォルト（青）</option>
                            <option value="purple">紫</option>
                            <option value="deep-blue">ディープブルー</option>
                            <option value="teal">ティール</option>
                            <option value="cyan">シアン</option>
                            <option value="ocean">オーシャン</option>
                            <option value="sky">スカイブルー</option>
                            <option value="indigo">インディゴ</option>
                            <option value="navy">ネイビー</option>
                            <option value="slate">スレート</option>
                            <option value="green">グリーン</option>
                            <option value="emerald">エメラルド</option>
                        </select>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            タブの色を個別に設定できます
                        </small>
                    </div>

                    <div class="form-group">
                        <label>背景色</label>
                        <select id="themeBackgroundColor">
                            <option value="same">メインカラーと同じ</option>
                            <option value="purple">紫</option>
                            <option value="deep-blue">ディープブルー</option>
                            <option value="teal">ティール</option>
                            <option value="cyan">シアン</option>
                            <option value="ocean">オーシャン</option>
                            <option value="sky">スカイブルー</option>
                            <option value="indigo">インディゴ</option>
                            <option value="navy">ネイビー</option>
                            <option value="slate">スレート</option>
                            <option value="green">グリーン</option>
                            <option value="emerald">エメラルド</option>
                        </select>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            ページ全体の背景色を個別に設定できます
                        </small>
                    </div>

                    <!-- プレビュー -->
                    <div style="margin: 20px 0;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600;">プレビュー</label>
                        <div id="themePreview"
                            style="padding: 20px; border-radius: 8px; color: white; position: relative; overflow: hidden;">
                            <div style="font-size: 16px; font-weight: 600; margin-bottom: 10px;">クイック実績入力</div>
                            <div style="font-size: 14px;">レポート集計カード・アクティブタブにも適用されます</div>
                        </div>
                    </div>

                    <small style="color: #666; display: block; margin-top: 10px;">
                        ・設定は自動的に保存されます<br>
                        ・ページをリロードしても設定は保持されます
                    </small>
                </div>

                <!-- マトリクス表示の月色分け設定 -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>📊 マトリクス表示</h3>
                    <p style="color: #666; margin-bottom: 15px;">見積一覧・レポートのマトリクス表示に関する設定です。</p>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="showMonthColorsCheckbox" style="width: auto; margin-right: 10px;"
                                checked>
                            <span>見積一覧で月ごとに色分けする</span>
                        </label>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            ・オン: 見積一覧（全期間表示・月別表示）で工程の割当月に応じてセルを色分けします<br>
                            ・オフ: 色分けを無効にします
                        </small>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="showDeviationColorsCheckbox"
                                style="width: auto; margin-right: 10px; flex-shrink: 0;" checked>
                            <span>レポートで乖離率に応じた背景色を表示する</span>
                        </label>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            ・オン: レポートのマトリクス表示で見積と実績の乖離率に応じて背景色をグラデーション表示します<br>
                            ・オフ: 背景色を無効にします（白背景）
                        </small>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="showProgressBarsCheckbox"
                                style="width: auto; margin-right: 10px; flex-shrink: 0;" checked>
                            <span>レポートで進捗バーを表示する</span>
                        </label>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            ・オン: レポートのマトリクス表示で見込残存時間ベースの進捗バーを表示します<br>
                            ・オフ: 進捗バーを非表示にします
                        </small>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label style="font-weight: 600; margin-bottom: 10px; display: block;">進捗バーのスタイル</label>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: flex-start; cursor: pointer;">
                                <input type="radio" name="progressBarStyle" value="inline"
                                    style="margin-top: 3px; margin-right: 8px; flex-shrink: 0;" checked>
                                <span style="flex: 1;">
                                    <strong>セル内に表示</strong><br>
                                    <small style="color: #666;">進捗バーをセルのコンテンツとして表示（パーセンテージ表示可能）</small>
                                </span>
                            </label>
                            <label style="display: flex; align-items: flex-start; cursor: pointer;">
                                <input type="radio" name="progressBarStyle" value="bottom"
                                    style="margin-top: 3px; margin-right: 8px; flex-shrink: 0;">
                                <span style="flex: 1;">
                                    <strong>セル下部に表示</strong><br>
                                    <small style="color: #666;">進捗バーをセルの下部枠線として表示（パーセンテージは非表示）</small>
                                </span>
                            </label>
                        </div>
                        <small style="color: #666; display: block; margin-top: 10px;">
                            進捗バーの表示位置を選択できます
                        </small>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="showProgressPercentageCheckbox"
                                style="width: auto; margin-right: 10px; flex-shrink: 0;" checked>
                            <span>進捗バーにパーセンテージを表示する</span>
                        </label>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            ・オン: 進捗バーの下にパーセンテージ（例: 75%）を表示します<br>
                            ・オフ: パーセンテージを非表示にします（ツールチップで確認可能）<br>
                            ・注意: 「セル下部に表示」スタイルではパーセンテージは表示されません
                        </small>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label
                            style="font-weight: 600; margin-bottom: 10px; display: block;">見積と実績の表示形式（レポートのマトリクス）</label>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: flex-start; cursor: pointer;">
                                <input type="radio" name="matrixEstActFormat" value="twoRows"
                                    style="margin-top: 3px; margin-right: 8px; flex-shrink: 0;" checked>
                                <span style="flex: 1;">
                                    <strong>2行表示</strong><br>
                                    <small style="color: #666;">見積と実績を2行で表示（見積は細字、実績は太字）</small>
                                </span>
                            </label>
                            <label style="display: flex; align-items: flex-start; cursor: pointer;">
                                <input type="radio" name="matrixEstActFormat" value="slash"
                                    style="margin-top: 3px; margin-right: 8px; flex-shrink: 0;">
                                <span style="flex: 1;">
                                    <strong>スラッシュ横並び</strong><br>
                                    <small style="color: #666;">例: 10.0 / 15.5</small>
                                </span>
                            </label>
                        </div>
                        <small style="color: #666; display: block; margin-top: 10px;">
                            レポートタブのマトリクス表示で、見積と実績をどのように表示するか選択できます
                        </small>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label
                            style="font-weight: 600; margin-bottom: 10px; display: block;">人日/人月の表示形式（レポートの合計列）</label>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: flex-start; cursor: pointer;">
                                <input type="radio" name="matrixDayMonthFormat" value="inline"
                                    style="margin-top: 3px; margin-right: 8px; flex-shrink: 0;" checked>
                                <span style="flex: 1;">
                                    <strong>横に括弧で表示</strong><br>
                                    <small style="color: #666;">例: 10.0 (2.0人日/0.10人月)</small>
                                </span>
                            </label>
                            <label style="display: flex; align-items: flex-start; cursor: pointer;">
                                <input type="radio" name="matrixDayMonthFormat" value="separate"
                                    style="margin-top: 3px; margin-right: 8px; flex-shrink: 0;">
                                <span style="flex: 1;">
                                    <strong>別行で表示</strong><br>
                                    <small style="color: #666;">見積: 10.0 / 実績: 15.5<br>見積: 2.0人日/0.10人月 / 実績:
                                        3.1人日/0.16人月</small>
                                </span>
                            </label>
                            <label style="display: flex; align-items: flex-start; cursor: pointer;">
                                <input type="radio" name="matrixDayMonthFormat" value="side"
                                    style="margin-top: 3px; margin-right: 8px; flex-shrink: 0;">
                                <span style="flex: 1;">
                                    <strong>右側に表示</strong><br>
                                    <small style="color: #666;">見積 10.0　　　　2.0人日/0.10人月</small>
                                </span>
                            </label>
                            <label style="display: flex; align-items: flex-start; cursor: pointer;">
                                <input type="radio" name="matrixDayMonthFormat" value="arrow"
                                    style="margin-top: 3px; margin-right: 8px; flex-shrink: 0;">
                                <span style="flex: 1;">
                                    <strong>矢印で表示</strong><br>
                                    <small style="color: #666;">見積 10.0 → 2.0人日/0.10人月</small>
                                </span>
                            </label>
                        </div>
                        <small style="color: #666; display: block; margin-top: 10px;">
                            レポートタブのマトリクス表示で、合計列に表示される人日/人月の表示形式を選択できます
                        </small>
                    </div>
                </div>

                <!-- デフォルト表示形式設定 -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>📋 デフォルト表示形式</h3>
                    <p style="color: #666; margin-bottom: 15px;">見積一覧とレポートを開いたときに表示される初期表示形式を設定できます。</p>

                    <div class="form-group">
                        <label>見積一覧のデフォルト表示</label>
                        <select id="defaultEstimateViewType">
                            <option value="grouped">グループ</option>
                            <option value="matrix" selected>マトリクス</option>
                            <option value="list">リスト</option>
                        </select>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            見積一覧タブを開いたとき、または画面を読み込んだときの初期表示形式です。
                        </small>
                    </div>

                    <div class="form-group">
                        <label>レポートのデフォルト表示</label>
                        <select id="defaultReportViewType">
                            <option value="summary">サマリー</option>
                            <option value="grouped">グループ</option>
                            <option value="matrix" selected>マトリクス</option>
                        </select>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            レポートタブを開いたとき、または画面を読み込んだときの初期表示形式です。
                        </small>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>自動バックアップ</h3>
                    <p style="color: #666; margin-bottom: 15px;">データ保存時に自動的にJSONファイルをダウンロードします。</p>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="autoBackupEnabled" style="width: auto; margin-right: 10px;">
                            <span>自動バックアップを有効にする</span>
                        </label>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            ・オンにすると、実績や見積の登録・編集時に自動でバックアップファイルがダウンロードされます<br>
                            ・オフにしても、手動バックアップボタンは使用できます
                        </small>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>クイック入力モード</h3>
                    <p style="color: #666; margin-bottom: 15px;">クイック入力タブの実績入力/見積登録モードの動作を設定できます。</p>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="rememberQuickInputMode" style="width: auto; margin-right: 10px;">
                            <span>前回のモード（実績/見積）を記憶する</span>
                        </label>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            ・オフ（デフォルト）: 常に実績入力モードで開始します<br>
                            ・オン: 前回使用したモード（実績入力 or 見積登録）を記憶し、次回も同じモードで開始します
                        </small>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>担当者表示順</h3>
                    <p style="color: #666; margin-bottom: 15px;">
                        担当者の表示順序を指定できます。この順序は実績一覧、レポート、入力フォームなど全ての画面に適用されます。
                    </p>

                    <div class="form-group">
                        <label>表示順序 <button id="btnShowMemberOrderHelp"
                                style="border: none; background: none; cursor: pointer; color: #3498db; font-size: 18px;">ℹ️</button></label>
                        <input type="text" id="memberOrder" placeholder="例: A,B,C,D または 山田,佐藤,田中">
                        <small style="color: #666; display: block; margin-top: 5px;">
                            ・カンマ区切りで入力してください<br>
                            ・指定した順番で表示されます<br>
                            ・指定していない担当者は後ろにアルファベット順で表示されます<br>
                            ・設定は自動的に保存されます
                        </small>
                    </div>

                    <button class="btn btn-primary" id="btnUpdateAllDisplays" style="margin-top: 10px;">設定を適用</button>
                </div>

                <!-- UI/UX設定 -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>🖥️ UI/UX設定</h3>
                    <p style="color: #666; margin-bottom: 15px;">画面表示や操作性に関する設定です。</p>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="stickyFilterEnabled" style="width: auto; margin-right: 10px;"
                                checked>
                            <span>フィルタ固定表示（Sticky）を有効にする</span>
                        </label>
                        <small style="color: #666; display: block; margin-top: 5px; margin-left: 30px;">
                            見積一覧・レポートのフィルタ設定部分をスクロール時に画面上部に固定表示します。
                        </small>
                    </div>

                    <div class="form-group" style="margin-top: 15px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="floatingFilterEnabled" style="width: auto; margin-right: 10px;"
                                checked>
                            <span>フローティングフィルタパネルを有効にする</span>
                        </label>
                        <small style="color: #666; display: block; margin-top: 5px; margin-left: 30px;">
                            レポートタブで画面右下にフィルタ設定ボタンを表示します。スクロール位置に関係なくフィルタを変更できます。
                        </small>
                    </div>

                    <div class="form-group" style="margin-top: 15px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="debugModeEnabled" style="width: auto; margin-right: 10px;">
                            <span>デバッグモードを有効にする</span>
                        </label>
                        <small style="color: #666; display: block; margin-top: 5px; margin-left: 30px;">
                            エラー発生時に詳細なエラーメッセージを表示します。通常はオフで問題ありません。
                        </small>
                    </div>
                </div>

                <!-- グラフカラーパターン設定 -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>🎨 グラフカラーパターン</h3>
                    <p style="color: #666; margin-bottom: 15px;">レポートの担当者分析グラフ（見積・実績の棒グラフと工数内訳ドーナツグラフ）の配色を変更できます。
                    </p>

                    <div class="form-group">
                        <label>カラーパターン</label>
                        <select id="chartColorScheme">
                            <option value="auto">テーマカラーに合わせる（自動）</option>
                            <option value="classic">クラシック</option>
                            <option value="purple">紫</option>
                            <option value="indigo">インディゴ</option>
                            <option value="deep-blue">ディープブルー</option>
                            <option value="ocean">オーシャン</option>
                            <option value="sky">スカイブルー</option>
                            <option value="navy">ネイビー</option>
                            <option value="teal">ティール</option>
                            <option value="cyan">シアン</option>
                            <option value="green">グリーン</option>
                            <option value="emerald">エメラルド</option>
                            <option value="slate">スレート</option>
                        </select>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            ・「テーマカラーに合わせる（自動）」を選択すると、テーマカラー変更時にグラフの色も自動で変わります<br>
                            ・特定の色を固定したい場合は、個別のカラーパターンを選択してください<br>
                            ・設定は自動的に保存され、レポートの担当者分析グラフに適用されます
                        </small>
                    </div>

                    <!-- プレビュー -->
                    <div style="margin: 20px 0;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600;">プレビュー</label>

                        <!-- 棒グラフプレビュー -->
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <div style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: #495057;">見積
                                vs
                                実績の棒グラフ</div>
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div id="chartPreviewEstimateBar"
                                        style="width: 40px; height: 20px; border-radius: 3px;"></div>
                                    <span style="font-size: 12px; color: #495057;">見積</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div id="chartPreviewActualBar"
                                        style="width: 40px; height: 20px; border-radius: 3px;">
                                    </div>
                                    <span style="font-size: 12px; color: #495057;">実績</span>
                                </div>
                            </div>
                        </div>

                        <!-- ドーナツグラフプレビュー -->
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <div style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: #495057;">
                                工数内訳ドーナツグラフ</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <div id="chartPreviewUI" style="width: 20px; height: 20px; border-radius: 3px;">
                                    </div>
                                    <span style="font-size: 12px; color: #495057;">UI</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <div id="chartPreviewPG" style="width: 20px; height: 20px; border-radius: 3px;">
                                    </div>
                                    <span style="font-size: 12px; color: #495057;">PG</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <div id="chartPreviewPT" style="width: 20px; height: 20px; border-radius: 3px;">
                                    </div>
                                    <span style="font-size: 12px; color: #495057;">PT</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <div id="chartPreviewIT" style="width: 20px; height: 20px; border-radius: 3px;">
                                    </div>
                                    <span style="font-size: 12px; color: #495057;">IT</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <div id="chartPreviewST" style="width: 20px; height: 20px; border-radius: 3px;">
                                    </div>
                                    <span style="font-size: 12px; color: #495057;">ST</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>📊 レポート分析機能</h3>
                    <p style="color: #666; margin-bottom: 15px;">レポートに表示する分析機能を選択できます。</p>

                    <div class="form-group">
                        <label style="font-weight: 600; margin-bottom: 10px; display: block;">Phase 1:
                            即効性の高い改善</label>

                        <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 8px;">
                            <input type="checkbox" id="reportAccuracyEnabled" style="width: auto; margin-right: 10px;"
                                checked>
                            <span>見積精度の%表示（工程別、版数別）</span>
                        </label>

                        <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 8px;">
                            <input type="checkbox" id="reportAnomalyEnabled" style="width: auto; margin-right: 10px;"
                                checked>
                            <span>異常値のハイライト表示（50%超過を強調）</span>
                        </label>

                        <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 8px;">
                            <input type="checkbox" id="reportWarningTasksEnabled"
                                style="width: auto; margin-right: 10px;" checked>
                            <span>要注意タスクのリスト表示</span>
                        </label>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label style="font-weight: 600; margin-bottom: 10px; display: block;">Phase 2:
                            視覚化の強化</label>

                        <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 8px;">
                            <input type="checkbox" id="reportChartEnabled" style="width: auto; margin-right: 10px;"
                                checked>
                            <span>棒グラフ表示（版数別、工程別）</span>
                        </label>

                        <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 8px;">
                            <input type="checkbox" id="reportTrendEnabled" style="width: auto; margin-right: 10px;"
                                checked>
                            <span>月別推移の表示</span>
                        </label>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label style="font-weight: 600; margin-bottom: 10px; display: block;">Phase 3: 高度な分析</label>

                        <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 8px;">
                            <input type="checkbox" id="reportMemberAnalysisEnabled"
                                style="width: auto; margin-right: 10px;" checked>
                            <span>担当者別の詳細分析</span>
                        </label>

                        <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 8px;">
                            <input type="checkbox" id="reportInsightsEnabled" style="width: auto; margin-right: 10px;"
                                checked>
                            <span>インサイト・推奨アクションの表示</span>
                        </label>
                    </div>

                    <small style="color: #666; display: block; margin-top: 10px;">
                        ・設定は自動的に保存されます<br>
                        ・不要な機能をオフにすることで、シンプルなレポート表示にできます
                    </small>
                </div>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>🏢 会社休日設定</h3>
                    <p style="color: #666; margin-bottom: 15px;">会社の夏季休暇、年末年始休暇などを登録できます。実働日数の計算に反映されます。</p>

                    <div class="form-group">
                        <label>休日名</label>
                        <input type="text" id="companyHolidayName" placeholder="例: 夏季休暇">
                    </div>

                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <div class="form-group" style="flex: 1; margin: 0;">
                            <label>開始日</label>
                            <input type="date" id="companyHolidayStartDate">
                        </div>
                        <div class="form-group" style="flex: 1; margin: 0;">
                            <label>終了日</label>
                            <input type="date" id="companyHolidayEndDate">
                        </div>
                    </div>

                    <button class="btn btn-primary" id="btnAddCompanyHoliday"
                        style="margin-bottom: 20px;">休日を追加</button>

                    <div id="companyHolidayList"></div>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" accept=".json,.xlsx,.xls" style="display: none;">

    <!-- 作業詳細モーダル -->
    <div id="workModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">作業詳細</h3>
                <button class="modal-close" id="btnCloseWorkModal">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
            </div>
        </div>
    </div>

    <!-- 実績編集モーダル -->
    <div id="editActualModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>実績データを編集</h3>
                <button class="modal-close" id="btnCloseEditActualModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editActualId">
                <div class="form-group">
                    <label>日付</label>
                    <input type="date" id="editActualDate" style="max-width: 200px;">
                </div>
                <div class="form-group">
                    <label>版数</label>
                    <select id="editActualVersion">
                        <option value="">-- 版数を選択 --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>対応名</label>
                    <select id="editActualTaskSelect" style="margin-bottom: 10px;">
                        <option value="">-- 対応を選択 --</option>
                    </select>
                    <input type="text" id="editActualTaskSearch" placeholder="対応名を入力" style="display: none;">

                </div>
                <div class="form-group">
                    <label>工程</label>
                    <select id="editActualProcess">
                        <option value="">全工程</option>
                        <option value="UI">UI</option>
                        <option value="PG">PG</option>
                        <option value="PT">PT</option>
                        <option value="IT">IT</option>
                        <option value="ST">ST</option>
                    </select>
                    <small style="color: #666; display: block; margin-top: 5px;">
                        工程を選択して候補を絞り込むことができます。
                    </small>
                </div>
                <div class="form-group">
                    <label>担当</label>
                    <select id="editActualMember">
                    </select>
                    <span id="editActualMemberDisplay"
                        style="display: none; padding: 10px; background: #f5f5f5; border-radius: 6px; font-weight: 600;"></span>
                </div>
                <div class="form-group">
                    <label>実績工数</label>
                    <input type="number" id="editActualHours" step="0.5" min="0" placeholder="8">
                </div>
                <div class="form-group" id="remainingHoursGroup">
                    <label>見込残存時間</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="number" id="editActualRemainingHours" step="0.5" min="0" placeholder="0"
                            style="flex: 1; max-width: 120px;">
                        <span style="color: #666; font-size: 13px;">時間</span>
                    </div>
                    <small style="color: #666; display: block; margin-top: 5px;">この対応にあと何時間で完了予定か入力（0=完了）</small>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                    <button class="btn btn-primary" id="btnSaveActualEdit">保存</button>
                    <button class="btn" id="editActualOtherBtn"
                        style="background: #27ae60; color: white; display: none;">その他作業</button>
                    <button class="btn" id="editActualVacationBtn"
                        style="background: #f57c00; color: white; display: none;">休暇登録</button>
                    <button class="btn" id="btnCloseEditActualModalCancel"
                        style="background: #95a5a6; color: white;">キャンセル</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 見込残存時間一括編集モーダル -->
    <div id="bulkRemainingModal" class="modal">
        <div class="modal-content" style="max-width: 1000px; max-height: 85vh;">
            <div class="modal-header">
                <h3>見込残存時間の一括編集</h3>
                <button class="modal-close" onclick="closeBulkRemainingModal()">&times;</button>
            </div>
            <div class="modal-body" style="overflow-y: auto; max-height: calc(85vh - 120px);">
                <div style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center;">
                    <label>版数フィルタ:</label>
                    <select id="bulkRemainingVersionFilter" onchange="renderBulkRemainingTable()"
                        style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px;">
                        <option value="all">全版数</option>
                    </select>
                </div>
                <div class="table-wrapper" style="overflow-x: auto;">
                    <table id="bulkRemainingTable" style="width: 100%; border-collapse: collapse; min-width: 800px;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">版数</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">対応名</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">工程</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">担当</th>
                                <th style="padding: 10px; text-align: right; border-bottom: 2px solid #ddd;">見積</th>
                                <th style="padding: 10px; text-align: right; border-bottom: 2px solid #ddd;">実績</th>
                                <th style="padding: 10px; text-align: right; border-bottom: 2px solid #ddd;">残存</th>
                                <th style="padding: 10px; text-align: right; border-bottom: 2px solid #ddd;">予測総工数
                                </th>
                                <th style="padding: 10px; text-align: center; border-bottom: 2px solid #ddd;">状態
                                </th>
                            </tr>
                        </thead>
                        <tbody id="bulkRemainingTableBody">
                            <!-- 動的に生成 -->
                        </tbody>
                    </table>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end;">
                    <button class="btn btn-primary" id="btnSaveBulkRemaining">保存</button>
                    <button class="btn" id="btnCloseBulkRemaining"
                        style="background: #95a5a6; color: white;">キャンセル</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 休暇登録モーダル -->
    <div id="vacationModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #f57c00 0%, #ff9800 100%);">
                <h3 style="color: white;">休暇を登録</h3>
                <button class="modal-close" id="btnCloseVacationModal" style="color: white;">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="vacationModalMember">
                <input type="hidden" id="vacationModalDate">
                <div class="form-group">
                    <label>担当者</label>
                    <div id="vacationModalMemberDisplay"
                        style="padding: 10px; background: #f5f5f5; border-radius: 6px; font-weight: 600;"></div>
                </div>
                <div class="form-group">
                    <label>日付</label>
                    <div id="vacationModalDateDisplay"
                        style="padding: 10px; background: #f5f5f5; border-radius: 6px; font-weight: 600;"></div>
                </div>
                <div class="form-group">
                    <label>休暇タイプ</label>
                    <select id="vacationModalType">
                        <option value="有休">有給休暇（有休）</option>
                        <option value="特休">特別休暇（特休）</option>
                        <option value="代休">代休（代休）</option>
                        <option value="振休">振替休日（振休）</option>
                        <option value="時間休">時間休</option>
                    </select>
                </div>
                <div class="form-group" id="vacationModalHoursGroup">
                    <label>時間数 (h)</label>
                    <input type="number" id="vacationModalHours" step="1" min="1" max="8" value="8">
                    <small style="color: #666; display: block; margin-top: 5px;">時間休は1h単位で入力。全日休暇は8h。</small>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-primary" id="btnSaveVacationFromModal"
                        style="background: #f57c00;">登録</button>
                    <button class="btn" id="btnCloseVacationModalCancel"
                        style="background: #95a5a6; color: white;">キャンセル</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 見積編集モーダル -->
    <div id="editEstimateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>見積データを編集</h3>
                <button class="modal-close" id="btnCloseEditEstimateModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editEstimateId">
                <div class="form-group">
                    <label>版数</label>
                    <select id="editEstimateVersion">
                        <option value="">-- 版数を選択 --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>対応名</label>
                    <input type="text" id="editEstimateTaskSearch" placeholder="検索または新規入力" list="editEstimateTaskList">
                    <datalist id="editEstimateTaskList">
                    </datalist>
                </div>
                <div class="form-group">
                    <label>工程</label>
                    <select id="editEstimateProcess">
                        <option value="UI">UI</option>
                        <option value="PG">PG</option>
                        <option value="PT">PT</option>
                        <option value="IT">IT</option>
                        <option value="ST">ST</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>担当</label>
                    <select id="editEstimateMember">
                    </select>
                </div>
                <div class="form-group">
                    <label>見積工数</label>
                    <input type="number" id="editEstimateHours" step="0.5" min="0" placeholder="8">
                    <small style="color: #666; display: block; margin-top: 5px;">
                        複数月に分割している場合、総工数が表示されます
                    </small>
                </div>
                <div class="form-group">
                    <label>作業月設定</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="editWorkMonthMode" value="single" checked
                                style="width: auto; margin-right: 5px;">
                            <span>単一月</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="editWorkMonthMode" value="multi"
                                style="width: auto; margin-right: 5px;">
                            <span>複数月分割</span>
                        </label>
                    </div>

                    <!-- 単一月モード -->
                    <div id="editSingleMonthSection">
                        <select id="editEstimateWorkMonth">
                            <option value="">-- 作業月を選択 --</option>
                        </select>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            この工程が実際に作業される月を指定します
                        </small>
                    </div>

                    <!-- 複数月分割モード -->
                    <div id="editMultiMonthSection" style="display: none;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; border: 1px solid #dee2e6;">
                            <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                                <label style="flex: 1;">作業期間:</label>
                                <select id="editStartMonth"></select>
                                <span>〜</span>
                                <select id="editEndMonth"></select>
                            </div>

                            <div style="display: flex; gap: 20px; margin-bottom: 10px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="editSplitMethod" value="equal" checked
                                        style="width: auto; margin-right: 5px;">
                                    <span>均等分割</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="editSplitMethod" value="manual"
                                        style="width: auto; margin-right: 5px;">
                                    <span>手動設定</span>
                                </label>
                            </div>

                            <div id="editMonthPreview"></div>
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-primary" id="btnSaveEstimateEdit">保存</button>
                    <button class="btn" id="btnCloseEditEstimateModalCancel"
                        style="background: #95a5a6; color: white;">キャンセル</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 対応編集モーダル -->
    <div id="editTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>対応名を編集</h3>
                <button class="modal-close" id="btnCloseEditTaskModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editTaskOldVersion">
                <input type="hidden" id="editTaskOldName">
                <div class="form-group">
                    <label>版数</label>
                    <select id="editTaskVersion">
                        <option value="">-- 版数を選択 --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>帳票名</label>
                    <select id="editTaskFormNameSelect">
                        <option value="">-- 帳票名を選択 --</option>
                        <option value="__new__">新規入力</option>
                    </select>
                    <input type="text" id="editTaskFormName" placeholder="帳票A" style="display: none;">
                </div>
                <div class="form-group">
                    <label>対応名</label>
                    <input type="text" id="editTaskName" placeholder="X対応">
                </div>
                <div style="margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 6px;">
                    <div style="font-weight: 600; margin-bottom: 5px; color: #856404;">📝 変更内容</div>
                    <div style="font-size: 13px; color: #856404;">
                        この対応のすべての工程（UI、PG、PT、IT、ST）の版数と対応名が変更されます。関連する実績データも自動的に更新されます。</div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-primary" id="btnSaveTaskEdit">保存</button>
                    <button class="btn" id="btnCloseEditTaskModalCancel"
                        style="background: #95a5a6; color: white;">キャンセル</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 工程内訳表示モーダル -->
    <div id="processBreakdownModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="breakdownModalTitle">工程内訳</h3>
                <button class="modal-close" id="btnCloseProcessBreakdownModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="breakdownModalContent"></div>
            </div>
        </div>
    </div>

    <!-- 見込残存時間入力モーダル -->
    <div id="remainingHoursModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>工程の詳細</h3>
                <button class="modal-close" onclick="closeRemainingHoursModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="remainingHoursInfo"
                    style="background: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 20px; font-size: 14px;">
                    <!-- 版数、対応名、工程情報を表示 -->
                </div>

                <div id="remainingHoursMemberSelect" style="display: none; margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px;">担当者</label>
                    <select id="remainingHoursMember"
                        style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </select>
                </div>

                <div class="form-group">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px;">⏱️ 見込残存時間 (h)</label>
                    <input type="number" id="remainingHoursInput" step="0.1" min="0"
                        style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <small style="color: #666; display: block; margin-top: 5px;">
                        0を入力すると完了（100%）として扱われます
                    </small>
                </div>

                <!-- 登録実績リスト -->
                <div id="remainingHoursActualsList" style="margin-top: 24px; display: none;">
                    <label
                        style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px; color: #333;">📄
                        実績一覧（表示期間内）</label>
                    <div id="remainingHoursActualsContent"
                        style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 12px; max-height: 200px; overflow-y: auto;">
                        <!-- 実績リストをここに表示 -->
                    </div>
                </div>

                <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="closeRemainingHoursModal()"
                        style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">キャンセル</button>
                    <button onclick="saveRemainingHoursFromModal()"
                        style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 見積登録モーダル -->
    <div id="addEstimateModal" class="modal">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>📝 見積登録</h3>
                <button class="modal-close" onclick="closeAddEstimateModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>版数</label>
                    <select id="addEstVersion" onchange="handleVersionChange('addEstVersion')">
                        <option value="">-- 版数を選択 --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>帳票名</label>
                    <select id="addEstFormNameSelect" onchange="handleAddFormNameChange()">
                        <option value="">-- 帳票名を選択 --</option>
                        <option value="__new__">新規入力</option>
                    </select>
                    <input type="text" id="addEstFormName" placeholder="帳票A" style="display: none;">
                    <small style="color: #666; display: block; margin-top: 5px;">既存の帳票名を選択、または新規入力できます</small>
                </div>
                <div class="form-group">
                    <label>対応名</label>
                    <input type="text" id="addEstTask" placeholder="X対応">
                </div>
                <div class="form-group">
                    <label>作業月</label>
                    <div style="display: flex; gap: 12px; margin-bottom: 8px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="addEstMonthType" value="single" checked
                                onchange="switchAddEstMonthType()" style="width: auto; margin-right: 4px;">
                            <span style="font-size: 14px;">単一月</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="addEstMonthType" value="multi" onchange="switchAddEstMonthType()"
                                style="width: auto; margin-right: 4px;">
                            <span style="font-size: 14px;">複数月</span>
                        </label>
                    </div>
                    <div id="addEstMonthInputs">
                        <div id="addEstSingleMonthInput" style="display: block;">
                            <select id="addEstStartMonth"></select>
                        </div>
                        <div id="addEstMultiMonthInput" style="display: none;">
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <select id="addEstStartMonthMulti"></select>
                                <span>〜</span>
                                <select id="addEstEndMonth"></select>
                            </div>
                        </div>
                    </div>
                </div>
                <h4 style="margin-bottom: 10px; margin-top: 20px;">各工程の見積</h4>
                <div class="estimate-table-wrapper">
                    <table class="estimate-table" id="addEstimateTable" style="width: 100%; margin: 0;">
                        <thead>
                            <tr>
                                <th style="width: 60px; padding: 8px; text-align: center;">工程</th>
                                <th style="width: 120px; padding: 8px;">担当</th>
                                <th style="width: 100px; padding: 8px;">時間</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="text-align: center; font-weight: 600;"><span class="badge badge-ui">UI</span>
                                </td>
                                <td><select id="addEstUI_member" style="margin: 0;"></select></td>
                                <td><input type="number" id="addEstUI" placeholder="h" step="0.5" style="margin: 0;"
                                        oninput="updateAddEstimateTotals()"></td>
                            </tr>
                            <tr>
                                <td style="text-align: center; font-weight: 600;"><span class="badge badge-pg">PG</span>
                                </td>
                                <td><select id="addEstPG_member" style="margin: 0;"
                                        onchange="autoFillMember('addEstPG_member')"></select></td>
                                <td><input type="number" id="addEstPG" placeholder="h" step="0.5" style="margin: 0;"
                                        oninput="updateAddEstimateTotals()"></td>
                            </tr>
                            <tr>
                                <td style="text-align: center; font-weight: 600;"><span class="badge badge-pt">PT</span>
                                </td>
                                <td><select id="addEstPT_member" style="margin: 0;"
                                        onchange="autoFillMember('addEstPT_member')"></select></td>
                                <td><input type="number" id="addEstPT" placeholder="h" step="0.5" style="margin: 0;"
                                        oninput="updateAddEstimateTotals()"></td>
                            </tr>
                            <tr>
                                <td style="text-align: center; font-weight: 600;"><span class="badge badge-it">IT</span>
                                </td>
                                <td><select id="addEstIT_member" style="margin: 0;"
                                        onchange="autoFillMember('addEstIT_member')"></select></td>
                                <td><input type="number" id="addEstIT" placeholder="h" step="0.5" style="margin: 0;"
                                        oninput="updateAddEstimateTotals()"></td>
                            </tr>
                            <tr>
                                <td style="text-align: center; font-weight: 600;"><span class="badge badge-st">ST</span>
                                </td>
                                <td><select id="addEstST_member" style="margin: 0;"
                                        onchange="autoFillMember('addEstST_member')"></select></td>
                                <td><input type="number" id="addEstST" placeholder="h" step="0.5" style="margin: 0;"
                                        oninput="updateAddEstimateTotals()"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 合計表示エリア -->
                <div id="addEstimateTotals"
                    style="background: #e3f2fd; padding: 12px 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #1976d2;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                        <span style="font-weight: 600; color: #1565c0;">対応合計:</span>
                        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                            <span style="color: #1565c0;"><strong id="addEstTotalHours">0.0</strong> h</span>
                            <span style="color: #1976d2;">(<span id="addEstTotalDays">0.0</span> 人日)</span>
                            <span style="color: #1976d2;">(<span id="addEstTotalMonths">0.00</span> 人月)</span>
                        </div>
                    </div>
                </div>

                <!-- 月分割アシスタント -->
                <div
                    style="background: #fff3e0; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #fb8c00;">
                    <div class="form-group" style="margin-bottom: 10px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="addEnableMonthSplit" onchange="toggleAddMonthSplit()"
                                style="width: auto; margin-right: 10px;">
                            <span style="font-weight: 600; color: #e65100;">📅 複数月に分割して登録</span>
                        </label>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            一つの工程を複数月で作業する場合に、月別の工数を設定できます
                        </small>
                    </div>

                    <div id="addMonthSplitPanel" style="display: none; margin-top: 15px;">
                        <div class="form-group">
                            <label>分割する工程を選択</label>
                            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="addSplitUI" class="add-split-process-checkbox"
                                        style="width: auto; margin-right: 5px;">
                                    <span>UI</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="addSplitPG" class="add-split-process-checkbox"
                                        style="width: auto; margin-right: 5px;">
                                    <span>PG</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="addSplitPT" class="add-split-process-checkbox"
                                        style="width: auto; margin-right: 5px;">
                                    <span>PT</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="addSplitIT" class="add-split-process-checkbox"
                                        style="width: auto; margin-right: 5px;">
                                    <span>IT</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="addSplitST" class="add-split-process-checkbox"
                                        style="width: auto; margin-right: 5px;">
                                    <span>ST</span>
                                </label>
                            </div>
                            <small style="color: #666; display: block; margin-top: 5px;">
                                チェックした工程のみが月分割されます。チェックしていない工程は通常通り登録されます。
                            </small>
                        </div>

                        <div class="form-group">
                            <label>総工数</label>
                            <input type="number" id="addTotalHours" step="0.1" min="0" placeholder="例: 80"
                                oninput="updateAddMonthPreview()">
                            <span style="margin-left: 5px;">時間</span>
                        </div>

                        <div class="form-group">
                            <label>作業期間</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <select id="addStartMonth" onchange="updateAddMonthPreview()"></select>
                                <span>〜</span>
                                <select id="addEndMonth" onchange="updateAddMonthPreview()"></select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>分割方法</label>
                            <div style="display: flex; gap: 20px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="addSplitMethod" value="equal" checked
                                        onchange="updateAddMonthPreview()" style="width: auto; margin-right: 5px;">
                                    <span>均等分割</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="addSplitMethod" value="manual"
                                        onchange="updateAddMonthPreview()" style="width: auto; margin-right: 5px;">
                                    <span>手動設定</span>
                                </label>
                            </div>
                        </div>

                        <div id="addMonthPreview" style="margin-top: 15px;"></div>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="addEstimateFromModal()">登録</button>
                    <button class="btn" onclick="closeAddEstimateModal()"
                        style="background: #95a5a6; color: white;">キャンセル</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 既存見積の月分割モーダル -->
    <div id="splitEstimateModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>📅 見積を複数月に分割</h3>
                <button class="modal-close" onclick="closeSplitEstimateModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="splitEstimateId">

                <div style="background: #f0f0f0; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <strong>対象見積:</strong><br>
                    <div id="splitEstimateInfo" style="margin-top: 5px; color: #666;"></div>
                </div>

                <div class="form-group">
                    <label>総工数</label>
                    <input type="number" id="splitTotalHours" step="0.1" min="0" readonly style="background: #f0f0f0;">
                    <span style="margin-left: 5px;">時間</span>
                </div>

                <div class="form-group">
                    <label>作業期間</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <select id="splitStartMonth" onchange="updateSplitPreview()"></select>
                        <span>〜</span>
                        <select id="splitEndMonth" onchange="updateSplitPreview()"></select>
                    </div>
                </div>

                <div class="form-group">
                    <label>分割方法</label>
                    <div style="display: flex; gap: 20px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="splitMethodModal" value="equal" checked
                                onchange="updateSplitPreview()" style="width: auto; margin-right: 5px;">
                            <span>均等分割</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="splitMethodModal" value="manual" onchange="updateSplitPreview()"
                                style="width: auto; margin-right: 5px;">
                            <span>手動設定</span>
                        </label>
                    </div>
                </div>

                <div id="splitPreview" style="margin-top: 15px;"></div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="executeSplitEstimate()">分割を適用</button>
                    <button class="btn" onclick="closeSplitEstimateModal()"
                        style="background: #95a5a6; color: white;">キャンセル</button>
                </div>
            </div>
        </div>
    </div>

    <!-- その他作業モーダル -->
    <div id="otherWorkModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>その他作業の登録</h3>
                <button class="modal-close" onclick="closeOtherWorkModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- タブ切り替え -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0;">
                    <button id="meetingTab" class="other-work-tab active"
                        onclick="switchOtherWorkTab('meeting')">打ち合わせ</button>
                    <button id="customTab" class="other-work-tab" onclick="switchOtherWorkTab('custom')">任意作業</button>
                </div>

                <!-- 打ち合わせタブ -->
                <div id="meetingForm" class="other-work-form">
                    <p style="color: #666; margin-bottom: 15px;">全担当者に同じ工数で登録されます。</p>
                    <div class="form-group">
                        <label>工数 (h)</label>
                        <input type="number" id="meetingHours" step="0.5" min="0" placeholder="例: 2">
                    </div>
                    <button class="btn btn-success" onclick="addMeeting()">全員分追加</button>
                </div>

                <!-- 任意作業タブ -->
                <div id="customForm" class="other-work-form" style="display: none;">
                    <div class="form-group">
                        <label>作業名</label>
                        <input type="text" id="otherWorkName" placeholder="例: 環境構築、ドキュメント作成">
                    </div>
                    <div class="form-group">
                        <label>担当</label>
                        <select id="otherWorkMember">
                            <option value="">選択...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>工数 (h)</label>
                        <input type="number" id="otherWorkHours" step="0.5" min="0" placeholder="例: 4">
                    </div>
                    <button class="btn btn-success" onclick="addOtherWork()">追加</button>
                </div>
            </div>
        </div>
    </div>

    <!-- カスタムアラート -->
    <div id="customAlert" class="modal">
        <div class="custom-alert-content">
            <div class="custom-alert-body" id="customAlertMessage">
            </div>
            <div class="custom-alert-footer">
                <button class="btn btn-primary" onclick="closeCustomAlert()">OK</button>
            </div>
        </div>
    </div>

    <div id="floatingFilterPanelEstimate" class="floating-filter-panel">
        <div class="floating-filter-panel-header">
            <span>見積フィルタ設定</span>
            <button class="floating-filter-panel-close" onclick="toggleFloatingFilterPanel(event)">×</button>
        </div>
        <div class="floating-filter-panel-body">
            <!-- 編集モード -->
            <div class="floating-filter-group">
                <label class="floating-filter-label"
                    style="display: flex; justify-content: space-between; align-items: center;">
                    編集モード
                    <div class="toggle-switch">
                        <input type="checkbox" id="floatingEstimateEditMode"
                            onchange="toggleEstimateEditMode(this.checked)">
                        <label for="floatingEstimateEditMode" class="toggle-label"></label>
                    </div>
                </label>
            </div>

            <!-- フィルタタイプ選択 -->
            <div class="floating-filter-group">
                <label class="floating-filter-label">フィルタタイプ</label>
                <div class="floating-filter-buttons">
                    <button id="floatingEstFilterMonth" onclick="setFloatingEstFilterType('month')">月別</button>
                    <button id="floatingEstFilterVersion" onclick="setFloatingEstFilterType('version')">版数別</button>
                </div>
            </div>

            <!-- 月別フィルタ -->
            <div class="floating-filter-group" id="floatingEstMonthGroup">
                <label class="floating-filter-label">表示月</label>
                <div class="floating-segment-buttons" id="floatingEstMonthButtons"></div>
            </div>

            <!-- 版数別フィルタ -->
            <div class="floating-filter-group" id="floatingEstVersionGroup" style="display: none;">
                <label class="floating-filter-label">版数</label>
                <div class="floating-segment-buttons" id="floatingEstVersionButtons"></div>
            </div>

            <!-- 表示形式 -->
            <div class="floating-filter-group">
                <label class="floating-filter-label">表示形式</label>
                <div class="floating-filter-buttons">
                    <button id="floatingEstViewGrouped" onclick="setFloatingEstViewType('grouped')">グループ</button>
                    <button id="floatingEstViewMatrix" onclick="setFloatingEstViewType('matrix')">マトリクス</button>
                    <button id="floatingEstViewList" onclick="setFloatingEstViewType('list')">リスト</button>
                </div>
            </div>
        </div>
    </div>

    <!-- フローティングフィルタパネル -->
    <button class="floating-filter-toggle" id="floatingFilterToggle" onclick="toggleFloatingFilterPanel(event)">
        🔍
    </button>

    <div class="floating-filter-panel" id="floatingFilterPanel">
        <div class="floating-filter-panel-header">
            <span>フィルタ設定</span>
            <button class="floating-filter-panel-close" onclick="toggleFloatingFilterPanel(event)">×</button>
        </div>
        <div class="floating-filter-panel-body">
            <!-- フィルタタイプ選択 -->
            <div class="floating-filter-group">
                <label class="floating-filter-label">フィルタタイプ</label>
                <div class="floating-filter-buttons">
                    <button id="floatingFilterMonth" onclick="setFloatingFilterType('month')">月別</button>
                    <button id="floatingFilterVersion" onclick="setFloatingFilterType('version')">版数別</button>
                </div>
            </div>

            <!-- 月別フィルタ -->
            <div class="floating-filter-group" id="floatingMonthGroup">
                <label class="floating-filter-label">表示月</label>
                <div class="floating-segment-buttons" id="floatingMonthButtons"></div>
            </div>

            <!-- 版数別フィルタ -->
            <div class="floating-filter-group" id="floatingVersionGroup" style="display: none;">
                <label class="floating-filter-label">版数</label>
                <div class="floating-segment-buttons" id="floatingVersionButtons"></div>
            </div>

            <!-- 表示形式 -->
            <div class="floating-filter-group">
                <label class="floating-filter-label">表示形式</label>
                <div class="floating-filter-buttons">
                    <button id="floatingViewSummary" onclick="setFloatingViewType('summary')">サマリー</button>
                    <button id="floatingViewGrouped" onclick="setFloatingViewType('grouped')">グループ</button>
                    <button id="floatingViewMatrix" onclick="setFloatingViewType('matrix')">マトリクス</button>
                </div>
            </div>
        </div>
    </div>

    <!-- モジュールスクリプト -->
    <script type="module" src="js/init.js"></script>
</body>

</html>